<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>30分钟学会前端模块化开发（学习） | Eric的博客</title><meta name="author" content="Eric"><meta name="copyright" content="Eric"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="前言 早期的javascript版本没有块级作用域、没有类、没有包、也没有模块，这样会带来一些问题，如复用、依赖、冲突、代码组织混乱等，随着前端的膨胀，模块化显得非常迫切。  前端模块化规范如下：  一、前端模块化概要 模块概要   JavaScript在早期的设计中就没有模块、包、类的概念，开发者需要模拟出类似的功能，来隔离、组织复杂的JavaScript代码，我们称为模块化。 模块就是一个实现">
<meta property="og:type" content="article">
<meta property="og:title" content="30分钟学会前端模块化开发（学习）">
<meta property="og:url" content="http://example.com/2023/01/11/30%E5%88%86%E9%92%9F%E5%AD%A6%E4%BC%9A%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%80%E5%8F%91(%E5%AD%A6%E4%B9%A0)/index.html">
<meta property="og:site_name" content="Eric的博客">
<meta property="og:description" content="前言 早期的javascript版本没有块级作用域、没有类、没有包、也没有模块，这样会带来一些问题，如复用、依赖、冲突、代码组织混乱等，随着前端的膨胀，模块化显得非常迫切。  前端模块化规范如下：  一、前端模块化概要 模块概要   JavaScript在早期的设计中就没有模块、包、类的概念，开发者需要模拟出类似的功能，来隔离、组织复杂的JavaScript代码，我们称为模块化。 模块就是一个实现">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic.20988.xyz/2024-05-29/1716947455-652516-001-2.jpg">
<meta property="article:published_time" content="2023-01-10T16:00:00.000Z">
<meta property="article:modified_time" content="2024-07-02T15:04:08.035Z">
<meta property="article:author" content="Eric">
<meta property="article:tag" content="Eric的博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic.20988.xyz/2024-05-29/1716947455-652516-001-2.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/01/11/30%E5%88%86%E9%92%9F%E5%AD%A6%E4%BC%9A%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%80%E5%8F%91(%E5%AD%A6%E4%B9%A0)/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/Eric" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '30分钟学会前端模块化开发（学习）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-02 23:04:08'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/Avatar.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://pic.20988.xyz/2024-05-29/1716947455-652516-001-2.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Eric的博客"><span class="site-name">Eric的博客</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">30分钟学会前端模块化开发（学习）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-01-10T16:00:00.000Z" title="发表于 2023-01-11 00:00:00">2023-01-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-07-02T15:04:08.035Z" title="更新于 2024-07-02 23:04:08">2024-07-02</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="30分钟学会前端模块化开发（学习）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><blockquote>
<p>早期的javascript版本没有块级作用域、没有类、没有包、也没有模块，这样会带来一些问题，如复用、依赖、冲突、代码组织混乱等，随着前端的膨胀，模块化显得非常迫切。</p>
</blockquote>
<p>前端模块化规范如下：</p>
<p><img src="/images/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/1-1.png" alt="前端模块规范"></p>
<h3 id="一、前端模块化概要"><a href="#一、前端模块化概要" class="headerlink" title="一、前端模块化概要"></a>一、前端模块化概要</h3><ol>
<li>模块概要</li>
</ol>
<blockquote>
<p>JavaScript在早期的设计中就没有模块、包、类的概念，开发者需要模拟出类似的功能，来隔离、组织复杂的JavaScript代码，我们称为模块化。</p>
<p>模块就是一个实现特定功能的文件，有了模块我们就可以更方便的使用别人的代码，要用什么功能就加载什么模块。</p>
</blockquote>
<p><strong>模块化开发的四点好处：</strong></p>
<ul>
<li>避免变量污染，命名冲突</li>
<li>提高代码复用率</li>
<li>提高了可维护性</li>
<li>方便依赖关系管理<br>为了避免缺少模块带来的问题，我们可以看看程序员应对的历程：</li>
</ul>
<ol start="2">
<li>函数封装</li>
</ol>
<blockquote>
<p>我们在讲函数的时候提到，函数一个功能就是实现特定逻辑的一组语句打包，而且JavaScript的作用域就是基于函数的，所以把函数作为模块化的第一步是很自然的事情，在一个文件里面编写几个相关函数就是最开始的模块了</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//函数1</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">//statement</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//函数2</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn2</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">//statement</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样在需要的以后夹在函数所在文件，调用函数就可以了</p>
<p><strong>缺点：</strong></p>
<p>污染了全局变量，无法保证不与其他模块发生变量名冲突，而且模块成员之间没什么关系</p>
<ol start="3">
<li>对象封装</li>
</ol>
<p>为了解决上面问题，对象的写法应运而生，可以把所有的模块成员封装在一个对象中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myModule = &#123;</span><br><span class="line"><span class="attr">var1</span>: <span class="number">1</span>,</span><br><span class="line"></span><br><span class="line"><span class="attr">var2</span>: <span class="number">2</span>,</span><br><span class="line"></span><br><span class="line"><span class="attr">fn1</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="attr">fn2</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样我们在希望调用模块的时候引用对应文件，然后</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myModule.<span class="title function_">fn2</span>();</span><br></pre></td></tr></table></figure>

<p>这样避免了变量污染，只要保证模块名唯一即可，同时同一模块内的成员也有了关系<br>缺陷：外部可以随意修改内部成员，这样就会产生意外的安全问题</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myModel.<span class="property">var1</span> = <span class="number">100</span>;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>立即执行函数表达式（IIFE）</li>
</ol>
<p>可以通过立即执行函数表达式（IIFE），来达到隐藏细节的目的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myModule = (<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">var</span> var1 = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> var2 = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn2</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="attr">fn1</span>: fn1,</span><br><span class="line"><span class="attr">fn2</span>: fn2</span><br><span class="line">&#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p>这样在模块外部无法修改我们没有暴露出来的变量、函数</p>
<p><strong>缺点：功能相对较弱，封装过程增加了工作量、仍会导致命名空间污染可能、闭包是有成本的。</strong></p>
<p>JavaScript最初的作用仅仅是验证表单，后来会添加一些动画，但是这些js代码很多在一个文件中就可以完成了，所以，我们只需要在html文件中添加一个script标签。</p>
<p>后来，随着前端复杂度提高，为了能够提高项目代码的可读性、可扩展性等，我们的js文件逐渐多了起来，不再是一个js文件就可以解决的了，而是把每一个js文件当做一个模块。那么，这时的js引入方式是怎样的呢？大概是下面这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;jquery.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">　　<span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;jquery.artDialog.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">　　<span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">　　<span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;app1.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">　　<span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;app2.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">　　<span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;app3.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>即简单的将所有的js文件统统放在一起。但是这些文件的顺序还不能出错，比如jquery需要先引入，才能引入jquery插件，才能在其他的文件中使用jquery。</p>
<p>优点：</p>
<p>相比于使用一个js文件，这种多个js文件实现最简单的模块化的思想是进步的。</p>
<p>缺点：</p>
<p>污染全局作用域。 因为每一个模块都是暴露在全局的，简单的使用，会导致全局变量命名冲突，当然，我们也可以使用命名空间的方式来解决。</p>
<p>对于大型项目，各种js很多，开发人员必须手动解决模块和代码库的依赖关系，后期维护成本较高。</p>
<p>依赖关系不明显，不利于维护。 比如main.js需要使用jquery，但是，从上面的文件中，我们是看不出来的，<br>如果jquery忘记了，那么就会报错。</p>
<ol start="5">
<li>模块化规范</li>
</ol>
<p>常见的的JavaScript模块规范有：CommonJS、AMD、CMD、UMD、原生模块化</p>
<ul>
<li><strong>CommonJS</strong></li>
</ul>
<p>CommonJs 是服务器端模块的规范，Node.js采用了这个规范。</p>
<p>根据CommonJS规范，一个单独的文件就是一个模块。加载模块使用require方法，该方法读取一个文件并执行，最后返回文件内部的exports对象。</p>
<p> 例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// foobar.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//私有变量</span></span><br><span class="line"><span class="keyword">var</span> test = <span class="number">123</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//公有方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foobar</span> () &#123;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">foo</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// do someing ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">bar</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">//do someing ...</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//exports对象上的方法和变量是公有的</span></span><br><span class="line"><span class="keyword">var</span> foobar = <span class="keyword">new</span> <span class="title function_">foobar</span>();</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">foobar</span> = foobar;</span><br><span class="line"><span class="comment">//require方法默认读取js文件，所以可以省略js后缀</span></span><br><span class="line"><span class="keyword">var</span> test = <span class="built_in">require</span>(<span class="string">&#x27;./foobar&#x27;</span>).<span class="property">foobar</span>;</span><br><span class="line"></span><br><span class="line">test.<span class="title function_">bar</span>();</span><br></pre></td></tr></table></figure>

<p>CommonJS 加载模块是同步的，所以只有加载完成才能执行后面的操作。像Node.js主要用于服务器的编程，加载的模块文件一般都已经存在本地硬盘，所以加载起来比较快，不用考虑异步加载的方式，所以CommonJS规范比较适用。但如果是浏览器环境，要从服务器加载模块，这是就必须采用异步模式。所以就有了 AMD CMD 解决方案。</p>
<ul>
<li><strong>AMD((Asynchromous Module Definition) 异步模块定义</strong></li>
</ul>
<p>AMD 是 RequireJS 在推广过程中对模块定义的规范化产出</p>
<p>AMD异步加载模块。它的模块支持对象 函数 构造器 字符串 JSON等各种类型的模块。</p>
<p>适用AMD规范适用define方法定义模块。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过数组引入依赖 ，回调函数通过形参传入依赖</span></span><br><span class="line"><span class="title function_">define</span>([<span class="string">&#x27;someModule1&#x27;</span>, ‘someModule2’], <span class="keyword">function</span> (<span class="params">someModule1, someModule2</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span> () &#123;</span><br><span class="line"><span class="comment">/// someing</span></span><br><span class="line">someModule1.<span class="title function_">test</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> &#123;<span class="attr">foo</span>: foo&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">AMD</span>规范允许输出模块兼容<span class="title class_">CommonJS</span>规范，这时define方法如下：</span><br><span class="line"></span><br><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span> (<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> reqModule = <span class="built_in">require</span>(<span class="string">&quot;./someModule&quot;</span>);</span><br><span class="line">requModule.<span class="title function_">test</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">asplode</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">//someing</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>CMD（Common Module Definition）通用模块定义</strong></li>
</ul>
<p>CMD是SeaJS 在推广过程中对模块定义的规范化产出</p>
<p>CMD和AMD的区别有以下几点：</p>
<ul>
<li>对于依赖的模块AMD是提前执行，CMD是延迟执行。不过RequireJS从2.0开始，也改成可以延迟执行（根据写法不同，处理方式不通过）。</li>
<li>CMD推崇依赖就近，AMD推崇依赖前置。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//AMD</span></span><br><span class="line"><span class="title function_">define</span>([<span class="string">&#x27;./a&#x27;</span>,<span class="string">&#x27;./b&#x27;</span>], <span class="keyword">function</span> (<span class="params">a, b</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//依赖一开始就写好</span></span><br><span class="line">a.<span class="title function_">test</span>();</span><br><span class="line">b.<span class="title function_">test</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//CMD</span></span><br><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span> (<span class="params">requie, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//依赖可以就近书写</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">&#x27;./a&#x27;</span>);</span><br><span class="line">a.<span class="title function_">test</span>();</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">//软依赖</span></span><br><span class="line"><span class="keyword">if</span> (status) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = <span class="title function_">requie</span>(<span class="string">&#x27;./b&#x27;</span>);</span><br><span class="line">b.<span class="title function_">test</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>虽然 AMD也支持CMD写法，但依赖前置是官方文档的默认模块定义写法。</p>
<ul>
<li>AMD的api默认是一个当多个用，CMD严格的区分推崇职责单一。例如：AMD里require分全局的和局部的。CMD里面没有全局的 require,提供 seajs.use()来实现模块系统的加载启动。CMD里每个API都简单纯粹。</li>
</ul>
<p>SeaJS 和 RequireJS的主要区别 在此有解释</p>
<ul>
<li><strong>UMD</strong></li>
</ul>
<p>UMD是AMD和CommonJS的综合产物。</p>
<p>AMD 浏览器第一的原则发展 异步加载模块。</p>
<p>CommonJS 模块以服务器第一原则发展，选择同步加载，它的模块无需包装(unwrapped modules)。</p>
<p>这迫使人们又想出另一个更通用的模式UMD （Universal Module Definition）。希望解决跨平台的解决方案。</p>
<p>UMD先判断是否支持Node.js的模块（exports）是否存在，存在则使用Node.js模块模式。</p>
<p>在判断是否支持AMD（define是否存在），存在则使用AMD方式加载模块。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"><span class="variable language_">window</span>, factory</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">exports</span> === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">factory</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">&#x27;function&#x27;</span> &amp;&amp; define.<span class="property">amd</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="title function_">define</span>(factory);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">eventUtil</span> = <span class="title function_">factory</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;)(<span class="variable language_">this</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">//module ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>原生JS模块化（Native JS）</strong></li>
</ul>
<p>上述的模块都不是原生 JavaScript 模块。它们只不过是我们用模块模式（module pattern）、CommonJS 或 AMD 模仿的模块系统。</p>
<p>JavaScript标准制定者在 TC39（该标准定义了 ECMAScript 的语法与语义）已经为 ECMAScript 6（ES6）引入内置的模块系统了。</p>
<p>ES6 为导入（importing）导出（exporting）模块带来了很多可能性。下面是很好的资源：<br><a target="_blank" rel="noopener" href="http://jsmodules.io/">http://jsmodules.io/</a><br><a target="_blank" rel="noopener" href="http://exploringjs.com/">http://exploringjs.com/</a></p>
<p>相对于 CommonJS 或 AMD，ES6 模块如何设法提供两全其美的实现方案：简洁紧凑的声明式语法和异步加载，另外能更好地支持循环依赖。</p>
<ul>
<li><strong>小结</strong></li>
</ul>
<p>AMD（异步模块定义） 是 RequireJS 在推广过程中对模块定义的规范化产出，CMD（通用模块定义）是SeaJS 在推广过程中被广泛认知。RequireJs出自dojo加载器的作者James Burke，SeaJs出自国内前端大师玉伯。</p>
<p>两者的区别如下：</p>
<blockquote>
<p>RequireJS 和 SeaJS 都是很不错的模块加载器，两者区别如下：  </p>
<ol>
<li>两者定位有差异。RequireJS 想成为浏览器端的模块加载器，同时也想成为 Rhino &#x2F; Node 等环境的模块加载器。SeaJS 则专注于 Web 浏览器端，同时通过 Node 扩展的方式可以很方便跑在 Node 服务器端</li>
</ol>
</blockquote>
<ol start="2">
<li>两者遵循的标准有差异。RequireJS 遵循的是 AMD（异步模块定义）规范，SeaJS 遵循的是 CMD （通用模块定义）规范。规范的不同，导致了两者 API 的不同。SeaJS 更简洁优雅，更贴近 CommonJS Modules&#x2F;1.1 和 Node Modules 规范。  <blockquote>
<ol start="3">
<li>两者社区理念有差异。RequireJS 在尝试让第三方类库修改自身来支持 RequireJS，目前只有少数社区采纳。SeaJS 不强推，而采用自主封装的方式来“海纳百川”，目前已有较成熟的封装策略。  </li>
<li>两者代码质量有差异。RequireJS 是没有明显的 bug，SeaJS 是明显没有 bug。  </li>
<li>两者对调试等的支持有差异。SeaJS 通过插件，可以实现 Fiddler 中自动映射的功能，还可以实现自动 combo 等功能，非常方便便捷。RequireJS 无这方面的支持。  </li>
<li>两者的插件机制有差异。RequireJS 采取的是在源码中预留接口的形式，源码中留有为插件而写的代码。SeaJS 采取的插件机制则与 Node 的方式一致：开放自身，让插件开发者可直接访问或修改，从而非常灵活，可以实现各种类型的插件。</li>
</ol>
</blockquote>
</li>
</ol>
<h3 id="二、CommonJS"><a href="#二、CommonJS" class="headerlink" title="二、CommonJS"></a>二、CommonJS</h3><p>CommonJS就是一个JavaScript模块化的规范，该规范最初是用在服务器端NodeJS中，前端的webpack也是对CommonJS原生支持的。</p>
<p>根据这个规范，每一个文件就是一个模块，其内部定义的变量是属于这个模块的，不会对外暴露，也就是说不会污染全局变量。</p>
<p>CommonJS的核心思想就是通过 require 方法来同步加载所要依赖的其他模块，然后通过 exports 或者 module.exports 来导出需要暴露的接口。</p>
<p>CommonJS API编写应用程序，然后这些应用可以运行在不同的JavaScript解释器和不同的主机环境中。</p>
<p>2009年，美国程序员Ryan Dahl创造了node.js项目，将javascript语言用于服务器端编程。这标志”Javascript模块化编程”正式诞生。因为老实说，在浏览器环境下，以前没有模块也不是特别大的问题，毕竟网页程序的复杂性有限；但是在服务器端，一定要有模块，与操作系统和其他应用程序互动，否则根本没法编程。NodeJS是CommonJS规范的实现，webpack 也是以CommonJS的形式来书写。</p>
<p>CommonJS定义的模块分为:{模块引用(require)} {模块定义(exports)} {模块标识(module)}&#x2F;&#x2F;require()用来引入外部模块； &#x2F;&#x2F;exports对象用于导出当前模块的方法或变量，唯一的导出口； &#x2F;&#x2F;module对象就代表模块本身。</p>
<p>Nodejs的模块是基于CommonJS规范实现的，通过转换也可以运行在浏览器端。</p>
<p>特点：</p>
<p>1、所有代码都运行在模块作用域，不会污染全局作用域。</p>
<p>2、模块可以多次加载，但是只会在第一次加载时运行一次，然后运行结果就被缓存了，以后再加载，就直接读取缓存结果。要想让模块再次运行，必须清除缓存。</p>
<p>3、模块加载的顺序，按照其在代码中出现的顺序。</p>
<ul>
<li><p><strong>NodeJS中使用CommonJS模块管理</strong></p>
<ol>
<li>模块定义</li>
</ol>
</li>
</ul>
<p>根据commonJS规范，一个单独的文件是一个模块，每一个模块都是一个单独的作用域，也就是说，在该模块内部定义的变量，无法被其他模块读取，除非为global对象的属性。</p>
<p>模块只有一个出口，module.exports对象，我们需要把模块希望输出的内容放入该对象。</p>
<p>mathLib.js模块定义</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> message=<span class="string">&quot;Hello CommonJS!&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">message</span>=message;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">add</span>=<span class="function">(<span class="params">m,n</span>)=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(m+n);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>模块依赖</li>
</ol>
<p>加载模块用require方法，该方法读取一个文件并且执行，返回文件内部的module.exports对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">myApp.<span class="property">js</span> 模块依赖</span><br><span class="line"><span class="keyword">var</span> math=<span class="built_in">require</span>(<span class="string">&#x27;./mathLib&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(math.<span class="property">message</span>);</span><br><span class="line">math.<span class="title function_">add</span>(<span class="number">333</span>,<span class="number">888</span>);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>测试运行</li>
</ol>
<p>安装好node.JS</p>
<p>打开控制台，可以使用cmd命令，也可以直接在开发工具中访问<br><img src="/images/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/1-2.png"></p>
<p>运行</p>
<p><img src="/images/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/1-3.png"></p>
<ul>
<li><strong>在浏览器中使用CommonJS 模块管理</strong></li>
</ul>
<p>由于浏览器不支持 CommonJS 格式。要想让浏览器用上这些模块，必须转换格式。浏览器不兼容CommonJS的根本原因，在于缺少四个Node.js环境的变量（module、exports、require、global）。只要能够提供这四个变量，浏览器就能加载 CommonJS 模块。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> math = <span class="built_in">require</span>(<span class="string">&#x27;math&#x27;</span>); </span><br><span class="line"></span><br><span class="line">math.<span class="title function_">add</span>(<span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<p>第二行math.add(2, 3)，在第一行require(‘math’)之后运行，因此必须等math.js加载完成。也就是说，如果加载时间很长，整个应用就会停在那里等。这对服务器端不是一个问题，因为所有的模块都存放在本地硬盘，可以同步加载完成，等待时间就是硬盘的读取时间。但是，对于浏览器，这却是一个大问题，因为模块都放在服务器端，等待时间取决于网速的快慢，可能要等很长时间，浏览器处于”假死”状态<br>而browserify这样的一个工具，可以把nodejs的模块编译成浏览器可用的模块，解决上面提到的问题。本文将详细介绍Browserify实现Browserify是目前最常用的CommonJS格式转换的工具</p>
<p>请看一个例子，b.js模块加载a.js模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">100</span>;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">a</span> = a;</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="keyword">var</span> result = <span class="built_in">require</span>(<span class="string">&#x27;./a&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result.<span class="property">a</span>);</span><br></pre></td></tr></table></figure>

<p>index.html直接引用b.js会报错，提示require没有被定义</p>
<p><img src="/images/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/1-4.png"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.html</span></span><br><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;myApp_01.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>这时，就要使用Browserify了</p>
<p>【安装】</p>
<p>使用下列命令安装browserify</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g browserify</span><br></pre></td></tr></table></figure>

<p>【转换】</p>
<p>使用下面的命令，就能将b.js转为浏览器可用的格式bb.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">browserify myApp.<span class="property">js</span> &gt; myApp_01.<span class="property">js</span></span><br></pre></td></tr></table></figure>

<p>转换结果：<br><img src="/images/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/1-5.png"></p>
<p>查看myapp_01.js，browserify将mathLib.js和myApp.js这两个文件打包为MyApp01.js，使其在浏览器端可以运行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">r</span>(<span class="params">e, n, t</span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">o</span>(<span class="params">i, f</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!n[i]) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!e[i]) &#123;</span><br><span class="line">                    <span class="keyword">var</span> c = <span class="string">&quot;function&quot;</span> == <span class="keyword">typeof</span> <span class="built_in">require</span> &amp;&amp; <span class="built_in">require</span>;</span><br><span class="line">                    <span class="keyword">if</span> (!f &amp;&amp; c) <span class="keyword">return</span> <span class="title function_">c</span>(i, !<span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">if</span> (u) <span class="keyword">return</span> <span class="title function_">u</span>(i, !<span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Cannot find module &#x27;&quot;</span> + i + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">                    <span class="keyword">throw</span> a.<span class="property">code</span> = <span class="string">&quot;MODULE_NOT_FOUND&quot;</span>, a</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">var</span> p = n[i] = &#123;<span class="attr">exports</span>: &#123;&#125;&#125;;</span><br><span class="line">                e[i][<span class="number">0</span>].<span class="title function_">call</span>(p.<span class="property">exports</span>, <span class="keyword">function</span> (<span class="params">r</span>) &#123;</span><br><span class="line">                    <span class="keyword">var</span> n = e[i][<span class="number">1</span>][r];</span><br><span class="line">                    <span class="keyword">return</span> <span class="title function_">o</span>(n || r)</span><br><span class="line">                &#125;, p, p.<span class="property">exports</span>, r, e, n, t)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> n[i].<span class="property">exports</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> u = <span class="string">&quot;function&quot;</span> == <span class="keyword">typeof</span> <span class="built_in">require</span> &amp;&amp; <span class="built_in">require</span>, i = <span class="number">0</span>; i &lt; t.<span class="property">length</span>; i++) <span class="title function_">o</span>(t[i]);</span><br><span class="line">        <span class="keyword">return</span> o</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line">&#125;)()(&#123;</span><br><span class="line">    <span class="number">1</span>: [<span class="keyword">function</span> (<span class="params"><span class="built_in">require</span>, <span class="variable language_">module</span>, <span class="built_in">exports</span></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> message = <span class="string">&quot;Hello CommonJS!&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">message</span> = message;</span><br><span class="line">        <span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">add</span> = <span class="function">(<span class="params">m, n</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(m + n);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;, &#123;&#125;], <span class="number">2</span>: [<span class="keyword">function</span> (<span class="params"><span class="built_in">require</span>, <span class="variable language_">module</span>, <span class="built_in">exports</span></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> math = <span class="built_in">require</span>(<span class="string">&#x27;./mathLib&#x27;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(math.<span class="property">message</span>);</span><br><span class="line">        math.<span class="title function_">add</span>(<span class="number">333</span>, <span class="number">888</span>);</span><br><span class="line">    &#125;, &#123;<span class="string">&quot;./mathLib&quot;</span>: <span class="number">1</span>&#125;]</span><br><span class="line">&#125;, &#123;&#125;, [<span class="number">2</span>]);</span><br></pre></td></tr></table></figure>

<p>index.html引用bb.js，控制台显示100</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.html</span></span><br><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;bb.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>运行结果：<br><img src="/images/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/1-6.png"></p>
<p>虽然 Browserify 很强大，但不能在浏览器里操作，有时就很不方便。</p>
<p>纯浏览器的 CommonJS 模块加载器 require1k (<a target="_blank" rel="noopener" href="https://github.com/Stuk/require1k)%E3%80%82%E5%AE%8C%E5%85%A8%E4%B8%8D%E9%9C%80%E8%A6%81%E5%91%BD%E4%BB%A4%E8%A1%8C%EF%BC%8C%E7%9B%B4%E6%8E%A5%E6%94%BE%E8%BF%9B%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8D%B3%E5%8F%AF%E3%80%82">https://github.com/Stuk/require1k)。完全不需要命令行，直接放进浏览器即可。</a></p>
<p><em><strong>优点：</strong></em></p>
<p>CommonJS规范在服务器端率先完成了JavaScript的模块化，解决了依赖、全局变量污染的问题，这也是js运行在服务器端的必要条件。</p>
<p><em><strong>缺点：</strong></em></p>
<p>此文主要是浏览器端js的模块化， 由于 CommonJS 是同步加载模块的，在服务器端，文件都是保存在硬盘上，所以同步加载没有问题，但是对于浏览器端，需要将文件从服务器端请求过来，那么同步加载就不适用了，所以，CommonJS是不太适用于浏览器端。</p>
<h3 id="三、AMD"><a href="#三、AMD" class="headerlink" title="三、AMD"></a>三、AMD</h3><ul>
<li><strong>概要</strong></li>
</ul>
<p>CommonJS规范加载模块是同步的，也就是说，只有加载完成，才能执行后面的操作。AMD规范则是非同步加载模块，允许指定回调函数。由于Node.js主要用于服务器编程，模块文件一般都已经存在于本地硬盘，所以加载起来比较快，不用考虑非同步加载的方式，所以CommonJS规范比较适用。但是，如果是浏览器环境，要从服务器端加载模块，这时就必须采用非同步模式，因此浏览器端一般采用AMD规范。而AMD规范的实现，就是大名鼎鼎的require.js了。</p>
<ul>
<li><strong>require.js</strong></li>
</ul>
<p>Asynchronous Module Definition，中文名是异步模块定义。它是一个在浏览器端模块化开发的规范，由于不是js原生支持，使用AMD规范进行页面开发需要用到对应的函数库，也就是大名鼎鼎的RequireJS，实际上AMD是RequireJS在推广过程中对模块定义的规范化的产出。Asynchronous Module Definition，中文名是异步模块。它是一个在浏览器端模块化开发的规范，由于不是js原生支持，使用AMD规范进行页面开发需要用到对应的函数库，也就是大名鼎鼎的RequireJS，实际上AMD是RequireJS在推广过程中对模块定义的规范化的产出。</p>
<p>官网：<a target="_blank" rel="noopener" href="http://www.requirejs.cn/">http://www.requirejs.cn</a></p>
<p>requireJS主要解决两个问题：</p>
<p>1 多个js文件可能有依赖关系，被依赖的文件需要早于依赖它的文件加载到浏览器。</p>
<p>2 js加载的时候浏览器会停止页面渲染，加载文件愈多，页面失去响应的时间愈长。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义模块</span></span><br><span class="line"><span class="title function_">define</span>([<span class="string">&#x27;dependency&#x27;</span>],<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> name = <span class="string">&#x27;foo&#x27;</span>;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">printName</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">printName</span>:printName</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//加载模块</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>([<span class="string">&#x27;myModule&#x27;</span>],<span class="keyword">function</span>(<span class="params">my</span>)&#123;</span><br><span class="line">    my.<span class="title function_">printName</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>语法：</p>
<p>AMD标准中，定义了下面两个API：</p>
<ol>
<li><p>require([module], callback)  </p>
</li>
<li><p>define(id, [depends], callback)</p>
</li>
</ol>
<p>  即通过define来定义一个模块，然后使用require来加载一个模块。 并且，require还支持CommonJS的模块导出方式。</p>
<p>requireJS定义了一个函数define，它是全局变量，用来定义模块。</p>
<p><strong>define(id,dependencies,factory)</strong></p>
<p>——id 可选参数，用来定义模块的标识，如果没有提供该参数，脚本文件名（去掉拓展名）</p>
<p>——dependencies 是一个当前模块用来的模块名称数组</p>
<p>——factory 工厂方法，模块初始化要执行的函数或对象，如果为函数，它应该只被执行一次，如果是对象，此对象应该为模块的输出值。</p>
<p>在页面上使用require函数加载模块；</p>
<p>require([dependencies], function(){});</p>
<p>require()函数接受两个参数：</p>
<p>——第一个参数是一个数组，表示所依赖的模块；</p>
<p>——第二个参数是一个回调函数，当前面指定的模块都加载成功后，它将被调用。加载的模块会以参数形式传入该函数，从而在回调函数内部就可以使用这些模块</p>
<p>定义alert模块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">var</span> alertName = <span class="keyword">function</span> (<span class="params">str</span>) &#123;</span><br><span class="line"><span class="title function_">alert</span>(<span class="string">&quot;I am &quot;</span> + str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> alertAge = <span class="keyword">function</span> (<span class="params">num</span>) &#123;</span><br><span class="line"><span class="title function_">alert</span>(<span class="string">&quot;I am &quot;</span> + num + <span class="string">&quot; years old&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="attr">alertName</span>: alertName,</span><br><span class="line"><span class="attr">alertAge</span>: alertAge</span><br><span class="line">&#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>引入模块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>([<span class="string">&#x27;alert&#x27;</span>], <span class="keyword">function</span> (<span class="params">alert</span>) &#123;</span><br><span class="line">alert.<span class="title function_">alertName</span>(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line">alert.<span class="title function_">alertAge</span>(<span class="number">21</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>但是，在使用require.js的时候，我们必须要提前加载所有的依赖，然后才可以使用，而不是需要使用时再加载。</p>
<p><em><strong>优点：</strong></em></p>
<p>适合在浏览器环境中异步加载模块。可以并行加载多个模块。</p>
<p><em><strong>缺点：</strong></em></p>
<p>提高了开发成本，并且不能按需加载，而是必须提前加载所有的依赖。</p>
<ul>
<li><strong>使用技巧</strong></li>
</ul>
<p>请记住使用requirejs的口诀：两函数一配置一属性</p>
<ul>
<li>data-main属性</li>
</ul>
<p>requirejs需要一个根来作为搜索依赖的开始，data-main用来指定这个根。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;script src=<span class="string">&quot;scripts/require.js&quot;</span> data-main=<span class="string">&quot;scripts/app.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>这里就指定了根是app.js,只有直接或者间接与app.js有依赖关系的模块才会被插入到html中。</p>
<ul>
<li>require.config() 配置</li>
</ul>
<p>通过这个函数可以对requirejs进行灵活的配置，其参数为一个配置对象，配置项及含义如下：</p>
<p>baseUrl——用于加载模块的根路径。</p>
<p>paths——用于映射不存在根路径下面的模块路径。</p>
<p>shims——配置在脚本&#x2F;模块外面并没有使用RequireJS的函数依赖并且初始化函数。假设underscore并没有使用 RequireJS定义，但是你还是想通过RequireJS来使用它，那么你就需要在配置中把它定义为一个shim。<br>deps——加载依赖关系数组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>.<span class="title function_">config</span>(&#123;</span><br><span class="line"><span class="comment">//默认情况下从这个文件开始拉去取资源</span></span><br><span class="line">    <span class="attr">baseUrl</span>:<span class="string">&#x27;scripts/app&#x27;</span>,</span><br><span class="line"><span class="comment">//如果你的依赖模块以pb头，会从scripts/pb加载模块。</span></span><br><span class="line">    <span class="attr">paths</span>:&#123;</span><br><span class="line">        <span class="attr">pb</span>:<span class="string">&#x27;../pb&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="comment">// load backbone as a shim，所谓就是将没有采用requirejs方式定义</span></span><br><span class="line"><span class="comment">//模块的东西转变为requirejs模块</span></span><br><span class="line">    <span class="attr">shim</span>:&#123;</span><br><span class="line">        <span class="string">&#x27;backbone&#x27;</span>:&#123;</span><br><span class="line">            <span class="attr">deps</span>:[<span class="string">&#x27;underscore&#x27;</span>],</span><br><span class="line">            <span class="attr">exports</span>:<span class="string">&#x27;Backbone&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>define()函数</li>
</ul>
<p>该函数用于定义模块。形式如下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//logger.js</span></span><br><span class="line"><span class="title function_">define</span>([<span class="string">&quot;a&quot;</span>], <span class="keyword">function</span>(<span class="params">a</span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">info</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我是私有函数&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&quot;一个属性&quot;</span>,</span><br><span class="line">        <span class="attr">test</span>:<span class="keyword">function</span>(<span class="params">a</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(a+<span class="string">&quot;你好！&quot;</span>);</span><br><span class="line">            a.<span class="title function_">f</span>();</span><br><span class="line">            <span class="title function_">info</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>define函数就受两个参数。</p>
<ul>
<li><p>第一个是一个字符串数组，表示你定义的模块依赖的模块，这里依赖模块a;</p>
</li>
<li><p>第二个参数是一个函数，参数是注入前面依赖的模块，顺序同第一参数顺序。在函数中可做逻辑处理，通过return一个对象暴露模块的属性和方法，不在return中的可以认为是私有方法和私有属性。</p>
</li>
<li><p>require()函数</p>
</li>
</ul>
<p>该函数用于调用定义好的模块，可以是用define函数定义的，也可以是一个shim。形式如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app.js</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">&#x27;logger&#x27;</span>], <span class="keyword">function</span> (<span class="params">logger</span>) &#123;</span><br><span class="line">    logger.<span class="title function_">test</span>(<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(logger.<span class="property">name</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//输出结果：</span></span><br><span class="line"><span class="comment">//tom你好！</span></span><br><span class="line"><span class="comment">//不确定（取决于a模块的f方法）</span></span><br><span class="line"><span class="comment">//我是私有函数</span></span><br><span class="line"><span class="comment">//一个属性</span></span><br></pre></td></tr></table></figure>

<p>示例：</p>
<p> View Code</p>
<p>3.4、简单示例</p>
<p>目录结构：</p>
<p>模块定义：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> mathModule.<span class="property">js</span></span><br><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">   <span class="keyword">return</span>&#123;</span><br><span class="line">       <span class="attr">message</span>:<span class="string">&quot;Hello AMD!&quot;</span>,</span><br><span class="line">       <span class="attr">add</span>:<span class="keyword">function</span> (<span class="params">n1,n2</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> n1+n2;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>模块依赖：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> app.<span class="property">js</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">&#x27;mathModule&#x27;</span>],<span class="keyword">function</span> (<span class="params">mathModule</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(mathModule.<span class="property">message</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(mathModule.<span class="title function_">add</span>(<span class="number">100</span>,<span class="number">200</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>测试运行：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/require2.1.11.js&quot;</span> <span class="attr">data-main</span>=<span class="string">&quot;app.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>结果：<br><img src="/images/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/1-7.png"></p>
<ul>
<li>加载 JavaScript 文件</li>
</ul>
<p>RequireJS的目标是鼓励代码的模块化，它使用了不同于传统script标签的脚本加载步骤。可以用它来加速、优化代码，但其主要目的还是为了代码的模块化。它鼓励在使用脚本时以module ID替代URL地址。</p>
<p>RequireJS以一个相对于baseUrl的地址来加载所有的代码。页面顶层script标签含有一个特殊的属性data-main，require.js使用它来启动脚本加载过程，而baseUrl一般设置到与该属性相一致的目录。下列示例中展示了baseUrl的设置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--<span class="title class_">This</span> sets the baseUrl to the <span class="string">&quot;scripts&quot;</span> directory, and</span><br><span class="line">loads a script that will have a <span class="variable language_">module</span> <span class="variable constant_">ID</span> <span class="keyword">of</span> <span class="string">&#x27;main&#x27;</span>--&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">data-main</span>=<span class="string">&quot;scripts/main.js&quot;</span> <span class="attr">src</span>=<span class="string">&quot;scripts/require.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>baseUrl亦可通过RequireJS config手动设置。如果没有显式指定config及data-main，则默认的baseUrl为包含RequireJS的那个HTML页面的所属目录。</p>
<p>RequireJS默认假定所有的依赖资源都是js脚本，因此无需在module ID上再加”.js”后缀，RequireJS在进行module ID到path的解析时会自动补上后缀。你可以通过paths config设置一组脚本，这些有助于我们在使用脚本时码更少的字。</p>
<p>有时候你想避开”baseUrl + paths”的解析过程，而是直接指定加载某一个目录下的脚本。此时可以这样做：如果一个module ID符合下述规则之一，其ID解析会避开常规的”baseUrl + paths”配置，而是直接将其加载为一个相对于当前HTML文档的脚本：</p>
<p>以 “.js” 结束.</p>
<p>以 “&#x2F;“ 开始.</p>
<p>包含 URL 协议, 如 “http:” or “https:”.</p>
<p>一般来说，最好还是使用baseUrl及”paths” config去设置module ID。它会给你带来额外的灵活性，如便于脚本的重命名、重定位等。 同时，为了避免凌乱的配置，最好不要使用多级嵌套的目录层次来组织代码，而是要么将所有的脚本都放置到baseUrl中，要么分置为项目库&#x2F;第三方库的一个扁平结构，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">www/</span><br><span class="line">index.<span class="property">html</span></span><br><span class="line">js/</span><br><span class="line">app/</span><br><span class="line">sub.<span class="property">js</span></span><br><span class="line">lib/</span><br><span class="line">jquery.<span class="property">js</span></span><br><span class="line">canvas.<span class="property">js</span></span><br><span class="line">app.<span class="property">js</span></span><br></pre></td></tr></table></figure>

<p>index.html:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script data-main=<span class="string">&quot;js/app.js&quot;</span> src=<span class="string">&quot;js/require.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>app.js:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">requirejs.<span class="title function_">config</span>(&#123;</span><br><span class="line"><span class="comment">//By default load any module IDs from js/lib</span></span><br><span class="line">    <span class="attr">baseUrl</span>: <span class="string">&#x27;js/lib&#x27;</span>,</span><br><span class="line"><span class="comment">//except, if the module ID starts with &quot;app&quot;,</span></span><br><span class="line"><span class="comment">//load it from the js/app directory. paths</span></span><br><span class="line"><span class="comment">//config is relative to the baseUrl, and</span></span><br><span class="line"><span class="comment">//never includes a &quot;.js&quot; extension since</span></span><br><span class="line"><span class="comment">//the paths config could be for a directory.</span></span><br><span class="line">    <span class="attr">paths</span>: &#123;</span><br><span class="line">        <span class="attr">app</span>: <span class="string">&#x27;../app&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Start the main app logic.</span></span><br><span class="line">requirejs([<span class="string">&#x27;jquery&#x27;</span>, <span class="string">&#x27;canvas&#x27;</span>, <span class="string">&#x27;app/sub&#x27;</span>],</span><br><span class="line">    <span class="keyword">function</span> (<span class="params">$, canvas, sub</span>) &#123;</span><br><span class="line"><span class="comment">//jQuery, canvas and the app/sub module are all</span></span><br><span class="line"><span class="comment">//loaded and can be used here now.</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>注意在示例中，三方库如jQuery没有将版本号包含在他们的文件名中。我们建议将版本信息放置在单独的文件中来进行跟踪。使用诸如volo这类的工具，可以将package.json打上版本信息，并在磁盘上保持文件名为”jquery.js”。这有助于你保持配置的最小化，避免为每个库版本设置一条path。例如，将”jquery”配置为”jquery-1.7.2”。</p>
<p>理想状况下，每个加载的脚本都是通过define()来定义的一个模块；但有些”浏览器全局变量注入”型的传统&#x2F;遗留库并没有使用define()来定义它们的依赖关系，你必须为此使用shim config来指明它们的依赖关系。 如果你没有指明依赖关系，加载可能报错。这是因为基于速度的原因，RequireJS会异步地以无序的形式加载这些库。</p>
<ul>
<li><em><strong>路径处理</strong></em></li>
</ul>
<p>假定当前路径如下：<br><img src="/images/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/1-8.png"></p>
<p>moduleA：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">show</span>: <span class="function"><span class="params">m</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">info</span>(m)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>moduleB:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">define</span>([<span class="string">&#x27;moduleA&#x27;</span>], <span class="keyword">function</span> (<span class="params">a</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">add</span>: <span class="function">(<span class="params">m, n</span>) =&gt;</span> a.<span class="title function_">show</span>(m + n)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>app.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>([<span class="string">&#x27;module/moduleB&#x27;</span>], <span class="keyword">function</span> (<span class="params">b</span>) &#123;</span><br><span class="line">    b.<span class="title function_">add</span>(<span class="number">100</span>, <span class="number">500</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>index.html:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/require2.1.11.js&quot;</span> <span class="attr">data-main</span>=<span class="string">&quot;js/app.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>直接运行时，报错：<br><img src="/images/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/1-9.png"></p>
<p>解决方法一：</p>
<p>可以看出运行时报错，原因是baseUrl的值与app.js所在位置有关，当前应该是:baseUrl&#x3D;’js&#x2F;‘，那么所有模块在依赖时都默认以js&#x2F;开始，所以moduleB依赖ModuleA时也以js&#x2F;开始，可以通过指定当前目录解决该问题，修改moduleB如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">define</span>([<span class="string">&#x27;./moduleA&#x27;</span>], <span class="keyword">function</span> (<span class="params">a</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">add</span>: <span class="function">(<span class="params">m, n</span>) =&gt;</span> a.<span class="title function_">show</span>(m + n)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>.&#x2F;表示当前目录，..&#x2F;上一级，&#x2F;表示从域名开始不含虚拟目录</p>
<p>运行结果：</p>
<p>600</p>
<p>解决方法二：</p>
<p>手动配置baseUrl，修改后如下：</p>
<p>app.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置</span></span><br><span class="line">requirejs.<span class="title function_">config</span>(&#123;</span><br><span class="line">    <span class="comment">//模块依赖的基础路径，默认模块的加载位置</span></span><br><span class="line">    <span class="attr">baseUrl</span>:<span class="string">&#x27;js/module/&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//模块引用</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">&#x27;moduleB&#x27;</span>], <span class="keyword">function</span> (<span class="params">b</span>) &#123;</span><br><span class="line">    b.<span class="title function_">add</span>(<span class="number">100</span>, <span class="number">500</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">moduleB.<span class="property">js</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">define</span>([<span class="string">&#x27;moduleA&#x27;</span>], <span class="keyword">function</span> (<span class="params">a</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">add</span>: <span class="function">(<span class="params">m, n</span>) =&gt;</span> a.<span class="title function_">show</span>(m + n)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p>600</p>
<ul>
<li>依赖第三方的库（AMD依赖jQuery）</li>
</ul>
<p>jQuery 1.7 开始支持将 jQuery 注册为一个AMD异步模块。有很多兼容的脚本加载器（包括 RequireJS 和 curl）都可以用一个异步模块格式来加载模块，这也就表示不需要太多 hack 就能让一切运行起来。可以看看jQuery 1.7 中的源码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( <span class="keyword">typeof</span> define === <span class="string">&quot;function&quot;</span> &amp;&amp; define.<span class="property">amd</span> &amp;&amp; define.<span class="property">amd</span>.<span class="property">jQuery</span> ) &#123;</span><br><span class="line">　　<span class="title function_">define</span>( <span class="string">&quot;jquery&quot;</span>, [], <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="keyword">return</span> jQuery; &#125; );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其工作的原理是，所使用的脚本加载器通过指定一个属性，即 define.amd.jQuery 为 true，来标明自己可以支持多个 jQuery 版本。如果有兴趣了解特定的实现细节的话，我们可以将 jQuery 注册为一个具名模块，因为可能会有这样的风险，即它可能被与其它使用了 AMD 的 define() 方法的文件拼合在一起，而没有使用一个合适的、理解匿名 AMD 模块定义的拼合脚本。</p>
<p>高版本的jQuery （1.11.1） 去掉了define.amd.jQuery判断：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( <span class="keyword">typeof</span> define === <span class="string">&quot;function&quot;</span> &amp;&amp; define.<span class="property">amd</span> ) &#123;</span><br><span class="line">    <span class="title function_">define</span>( <span class="string">&quot;jquery&quot;</span>, [], <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> jQuery;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>示例代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置</span></span><br><span class="line">requirejs.<span class="title function_">config</span>(&#123;</span><br><span class="line">    <span class="comment">//模块依赖的基础路径，默认模块的加载位置</span></span><br><span class="line">    <span class="attr">baseUrl</span>:<span class="string">&#x27;js/&#x27;</span>,</span><br><span class="line">    <span class="comment">//路径</span></span><br><span class="line">    <span class="attr">paths</span>:&#123;</span><br><span class="line">        <span class="comment">//如果在路径前写上m/，则表示为：js/module/</span></span><br><span class="line">        <span class="attr">m</span>:<span class="string">&quot;module/&quot;</span>,</span><br><span class="line">        <span class="attr">jquery</span>:<span class="string">&#x27;common/jquery/jquery-1.12.4&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//模块引用</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">&#x27;m/moduleB&#x27;</span>,<span class="string">&#x27;m/moduleC&#x27;</span>,<span class="string">&#x27;jquery&#x27;</span>], <span class="keyword">function</span> (<span class="params">b,c,$</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> m=<span class="number">500</span>,n=<span class="number">100</span>;</span><br><span class="line">    b.<span class="title function_">add</span>(m, n);</span><br><span class="line">    c.<span class="title function_">sub</span>(m,n);</span><br><span class="line">    $(<span class="string">&quot;body&quot;</span>).<span class="title function_">css</span>(&#123;<span class="string">&quot;background&quot;</span>:<span class="string">&quot;yellow&quot;</span>&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>运行结果：<br><img src="/images/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/2-1.png"></p>
<ul>
<li>data-main 入口点</li>
</ul>
<p>require.js 在加载的时候会检察data-main 属性:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--when <span class="built_in">require</span>.<span class="property">js</span> loads it will inject another script tag (<span class="keyword">with</span> <span class="keyword">async</span> attribute) <span class="keyword">for</span> scripts/main.<span class="property">js</span>--&gt;<span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">data-main</span>=<span class="string">&quot;scripts/main&quot;</span> <span class="attr">src</span>=<span class="string">&quot;scripts/require.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>你可以在data-main指向的脚本中设置模板加载 选项，然后加载第一个应用模块。.注意：你在main.js中所设置的脚本是异步加载的。所以如果你在页面中配置了其它JS加载，则不能保证它们所依赖的JS已经加载成功。<br>例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script data-main=<span class="string">&quot;scripts/main&quot;</span> src=<span class="string">&quot;scripts/require.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;scripts/other.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p> main.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// contents of main.js:</span></span><br><span class="line"><span class="built_in">require</span>.<span class="title function_">config</span>(&#123;</span><br><span class="line">    <span class="attr">paths</span>: &#123;</span><br><span class="line">        <span class="attr">foo</span>: <span class="string">&#x27;libs/foo-1.1.3&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// contents of other.js:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// This code might be called before the require.config() in main.js</span></span><br><span class="line"><span class="comment">// has executed. When that happens, require.js will attempt to</span></span><br><span class="line"><span class="comment">// load &#x27;scripts/foo.js&#x27; instead of &#x27;scripts/libs/foo-1.1.3.js&#x27;</span></span><br><span class="line"><span class="built_in">require</span>( [<span class="string">&#x27;foo&#x27;</span>], <span class="keyword">function</span>(<span class="params"> foo </span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>3.7、定义模块</p>
<p>模块不同于传统的脚本文件，它良好地定义了一个作用域来避免全局名称空间污染。它可以显式地列出其依赖关系，并以函数(定义此模块的那个函数)参数的形式将这些依赖进行注入，而无需引用全局变量。RequireJS的模块是模块模式的一个扩展，其好处是无需全局地引用其他模块。</p>
<p>RequireJS的模块语法允许它尽快地加载多个模块，虽然加载的顺序不定，但依赖的顺序最终是正确的。同时因为无需创建全局变量，甚至可以做到在同一个页面上同时加载同一模块的不同版本。</p>
<p>(如果你熟悉ConmmonJS，可参看CommonJS的注释信息以了解RequireJS模块到CommonJS模块的映射关系)。<br>一个磁盘文件应该只定义 1 个模块。多个模块可以使用内置优化工具将其组织打包。</p>
<p>3.7.1、简单的值对</p>
<p>如果一个模块仅含值对，没有任何依赖，则在define()中定义这些值对就好了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Inside file my/shirt.js:</span></span><br><span class="line"><span class="title function_">define</span>(&#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="string">&quot;black&quot;</span>,</span><br><span class="line">    <span class="attr">size</span>: <span class="string">&quot;unisize&quot;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>3.7.2、函数式定义</p>
<p>如果一个模块没有任何依赖，但需要一个做setup工作的函数，则在define()中定义该函数，并将其传给define()：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//my/shirt.js now does setup work</span></span><br><span class="line"><span class="comment">//before returning its module definition.</span></span><br><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">//Do setup work here</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">color</span>: <span class="string">&quot;black&quot;</span>,</span><br><span class="line">        <span class="attr">size</span>: <span class="string">&quot;unisize&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>3.7.3、存在依赖的函数式定义</p>
<p>如果模块存在依赖：则第一个参数是依赖的名称数组；第二个参数是函数，在模块的所有依赖加载完毕后，该函数会被调用来定义该模块，因此该模块应该返回一个定义了本模块的object。依赖关系会以参数的形式注入到该函数上，参数列表与依赖名称列表一一对应。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//my/shirt.js now has some dependencies, a cart and inventory</span></span><br><span class="line"><span class="comment">//module in the same directory as shirt.js</span></span><br><span class="line"><span class="title function_">define</span>([<span class="string">&quot;./cart&quot;</span>, <span class="string">&quot;./inventory&quot;</span>], <span class="keyword">function</span>(<span class="params">cart, inventory</span>) &#123;</span><br><span class="line"><span class="comment">//return an object to define the &quot;my/shirt&quot; module.</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&quot;blue&quot;</span>,</span><br><span class="line">            <span class="attr">size</span>: <span class="string">&quot;large&quot;</span>,</span><br><span class="line">            <span class="attr">addToCart</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                inventory.<span class="title function_">decrement</span>(<span class="variable language_">this</span>);</span><br><span class="line">                cart.<span class="title function_">add</span>(<span class="variable language_">this</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>本示例创建了一个my&#x2F;shirt模块，它依赖于my&#x2F;cart及my&#x2F;inventory。磁盘上各文件分布如下：</p>
<p>my&#x2F;cart.js</p>
<p>my&#x2F;inventory.js</p>
<p>my&#x2F;shirt.js</p>
<p>模块函数以参数”cart”及”inventory”使用这两个以”.&#x2F;cart”及”.&#x2F;inventory”名称指定的模块。在这两个模块加载完毕之前，模块函数不会被调用。</p>
<p>严重不鼓励模块定义全局变量。遵循此处的定义模式，可以使得同一模块的不同版本并存于同一个页面上(参见 高级用法 )。另外，函参的顺序应与依赖顺序保存一致。</p>
<p>返回的object定义了”my&#x2F;shirt”模块。这种定义模式下，”my&#x2F;shirt”不作为一个全局变量而存在。</p>
<p>3.7.4、将模块定义为一个函数</p>
<p>对模块的返回值类型并没有强制为一定是个object，任何函数的返回值都是允许的。此处是一个返回了函数的模块定义：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//A module definition inside foo/title.js. It uses</span></span><br><span class="line"><span class="comment">//my/cart and my/inventory modules from before,</span></span><br><span class="line"><span class="comment">//but since foo/title.js is in a different directory than</span></span><br><span class="line"><span class="comment">//the &quot;my&quot; modules, it uses the &quot;my&quot; in the module dependency</span></span><br><span class="line"><span class="comment">//name to find them. The &quot;my&quot; part of the name can be mapped</span></span><br><span class="line"><span class="comment">//to any directory, but by default, it is assumed to be a</span></span><br><span class="line"><span class="comment">//sibling to the &quot;foo&quot; directory.</span></span><br><span class="line"><span class="title function_">define</span>([<span class="string">&quot;my/cart&quot;</span>, <span class="string">&quot;my/inventory&quot;</span>],</span><br><span class="line">    <span class="keyword">function</span>(<span class="params">cart, inventory</span>) &#123;</span><br><span class="line"><span class="comment">//return a function to define &quot;foo/title&quot;.</span></span><br><span class="line"><span class="comment">//It gets or sets the window title.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">title</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> title ? (<span class="variable language_">window</span>.<span class="property">title</span> = title) :</span><br><span class="line">                inventory.<span class="property">storeName</span> + <span class="string">&#x27; &#x27;</span> + cart.<span class="property">name</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>3.7.5、简单包装CommonJS来定义模块</p>
<p>如果你现有一些以CommonJS模块格式编写的代码，而这些代码难于使用上述依赖名称数组参数的形式来重构，你可以考虑直接将这些依赖对应到一些本地变量中进行使用。你可以使用一个CommonJS的简单包装来实现：</p>
<p>define(function(require, exports, module) {<br>        var a &#x3D; require(‘a’),<br>            b &#x3D; require(‘b’);</p>
<p>&#x2F;&#x2F;Return the module value<br>        return function () {};<br>    }<br>);</p>
<p>该包装方法依靠Function.prototype.toString()将函数内容赋予一个有意义的字串值，但在一些设备如PS3及一些老的Opera手机浏览器中不起作用。考虑在这些设备上使用优化器将依赖导出为数组形式。</p>
<p>更多的信息可参看CommonJS Notes页面，以及”Why AMD”页面的”Sugar”段落。</p>
<p>3.7.6、定义一个命名模块</p>
<p>你可能会看到一些define()中包含了一个模块名称作为首个参数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Explicitly defines the &quot;foo/title&quot; module:</span></span><br><span class="line"><span class="title function_">define</span>(<span class="string">&quot;foo/title&quot;</span>,</span><br><span class="line">    [<span class="string">&quot;my/cart&quot;</span>, <span class="string">&quot;my/inventory&quot;</span>],</span><br><span class="line">    <span class="keyword">function</span>(<span class="params">cart, inventory</span>) &#123;</span><br><span class="line"><span class="comment">//Define foo/title object in here.</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>这些常由优化工具生成。你也可以自己显式指定模块名称，但这使模块更不具备移植性——就是说若你将文件移动到其他目录下，你就得重命名。一般最好避免对模块硬编码，而是交给优化工具去生成。优化工具需要生成模块名以将多个模块打成一个包，加快到浏览器的载人速度。</p>
<p>示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">moduleD.<span class="property">js</span>：</span><br><span class="line"><span class="title function_">define</span>(<span class="string">&quot;md&quot;</span>,[],<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">hi</span>: <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&quot;Hello ModuleD!&quot;</span>)&#125;;</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="property">js</span>：</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置</span></span><br><span class="line">requirejs.<span class="title function_">config</span>(&#123;</span><br><span class="line">    <span class="comment">//模块依赖的基础路径，默认模块的加载位置</span></span><br><span class="line">    <span class="attr">baseUrl</span>:<span class="string">&#x27;js/&#x27;</span>,</span><br><span class="line">    <span class="comment">//路径</span></span><br><span class="line">    <span class="attr">paths</span>:&#123;</span><br><span class="line">        <span class="comment">//如果在路径前写上m/，则表示为：js/module/</span></span><br><span class="line">        <span class="attr">m</span>:<span class="string">&quot;module/&quot;</span>,</span><br><span class="line">        <span class="attr">jquery</span>:<span class="string">&#x27;common/jquery/jquery-1.12.4&#x27;</span>,</span><br><span class="line">        <span class="attr">md</span>:<span class="string">&#x27;module/moduleD&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//模块引用</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">&#x27;m/moduleB&#x27;</span>,<span class="string">&#x27;m/moduleC&#x27;</span>,<span class="string">&#x27;jquery&#x27;</span>,<span class="string">&#x27;md&#x27;</span>], <span class="keyword">function</span> (<span class="params">b,c,$,d</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> m=<span class="number">500</span>,n=<span class="number">100</span>;</span><br><span class="line">    b.<span class="title function_">add</span>(m, n);</span><br><span class="line">    c.<span class="title function_">sub</span>(m,n);</span><br><span class="line">    d.<span class="title function_">hi</span>();</span><br><span class="line">    $(<span class="string">&quot;body&quot;</span>).<span class="title function_">css</span>(&#123;<span class="string">&quot;background&quot;</span>:<span class="string">&quot;yellow&quot;</span>&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>使用命名模块时需要为命名模块指定路径，名称需唯一。<br>运行结果：<br><img src="/images/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/2-2.png"></p>
<p>3.7.7、依赖非AMD模块</p>
<p>配置中shim参数为那些没有使用define()来声明依赖关系、设置模块的”浏览器全局变量注入”型脚本做依赖和导出配置。</p>
<p>添加一个非amd模块moduleE.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> moduleE = &#123;</span><br><span class="line">    <span class="attr">hello</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&quot;Hello ModuleE!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>引用ModuleE：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置</span></span><br><span class="line">requirejs.<span class="title function_">config</span>(&#123;</span><br><span class="line">    <span class="comment">//模块依赖的基础路径，默认模块的加载位置</span></span><br><span class="line">    <span class="attr">baseUrl</span>:<span class="string">&#x27;js/&#x27;</span>,</span><br><span class="line">    <span class="comment">//路径</span></span><br><span class="line">    <span class="attr">paths</span>:&#123;</span><br><span class="line">        <span class="comment">//如果在路径前写上m/，则表示为：js/module/</span></span><br><span class="line">        <span class="attr">m</span>:<span class="string">&quot;module/&quot;</span>,</span><br><span class="line">        <span class="attr">jquery</span>:<span class="string">&#x27;common/jquery/jquery-1.12.4&#x27;</span>,</span><br><span class="line">        <span class="attr">md</span>:<span class="string">&#x27;module/moduleD&#x27;</span>,</span><br><span class="line">        <span class="attr">moduleE</span>:<span class="string">&#x27;module/moduleE&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//处理非标准的amd模块</span></span><br><span class="line">    <span class="attr">shim</span>:&#123;</span><br><span class="line">        <span class="comment">//这个键名为要载入的目标文件的文件名，不能随便命名否则拿不到改文件对外提供的接口的</span></span><br><span class="line">        <span class="string">&#x27;moduleE&#x27;</span>:&#123;</span><br><span class="line">            <span class="attr">exports</span>:<span class="string">&#x27;moduleE&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//模块引用</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">&#x27;m/moduleB&#x27;</span>,<span class="string">&#x27;m/moduleC&#x27;</span>,<span class="string">&#x27;jquery&#x27;</span>,<span class="string">&#x27;md&#x27;</span>,<span class="string">&#x27;moduleE&#x27;</span>], <span class="keyword">function</span> (<span class="params">b,c,$,d,e</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> m=<span class="number">500</span>,n=<span class="number">100</span>;</span><br><span class="line">    b.<span class="title function_">add</span>(m, n);</span><br><span class="line">    c.<span class="title function_">sub</span>(m,n);</span><br><span class="line">    d.<span class="title function_">hi</span>();</span><br><span class="line">    $(<span class="string">&quot;body&quot;</span>).<span class="title function_">css</span>(&#123;<span class="string">&quot;background&quot;</span>:<span class="string">&quot;yellow&quot;</span>&#125;);</span><br><span class="line">    e.<span class="title function_">hello</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>运行结果：<br><img src="/images/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/2-3.png"></p>
<p>3.7.8、注意事项</p>
<p>一个文件一个模块: 每个Javascript文件应该只定义一个模块，这是模块名-至-文件名查找机制的自然要求。多个模块会被优化工具组织优化，但你在使用优化工具时应将多个模块放置到一个文件中。</p>
<p>define()中的相对模块名: 为了可以在define()内部使用诸如require(“.&#x2F;relative&#x2F;name”)的调用以正确解析相对名称，记得将”require”本身作为一个依赖注入到模块中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">define</span>([<span class="string">&quot;require&quot;</span>, <span class="string">&quot;./relative/name&quot;</span>], <span class="keyword">function</span>(<span class="params"><span class="built_in">require</span></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> mod = <span class="built_in">require</span>(<span class="string">&quot;./relative/name&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>或者更好地，使用下述为转换CommonJS模块所设的更短的语法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> mod = <span class="built_in">require</span>(<span class="string">&quot;./relative/name&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>相对路径在一些场景下格外有用，例如：为了以便于将代码共享给其他人或项目，你在某个目录下创建了一些模块。你可以访问模块的相邻模块，无需知道该目录的名称。</p>
<p>生成相对于模块的URL地址: 你可能需要生成一个相对于模块的URL地址。你可以将”require”作为一个依赖注入进来，然后调用require.toUrl()以生成该URL:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">define</span>([<span class="string">&quot;require&quot;</span>], <span class="keyword">function</span>(<span class="params"><span class="built_in">require</span></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> cssUrl = <span class="built_in">require</span>.<span class="title function_">toUrl</span>(<span class="string">&quot;./style.css&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>控制台调试:如果你需要处理一个已通过require([“module&#x2F;name”], function(){})调用加载了的模块，可以使用模块名作为字符串参数的require()调用来获取它:</p>
<p>require(“module&#x2F;name”).callSomeFunction()</p>
<p>注意这种形式仅在”module&#x2F;name”已经由其异步形式的require([“module&#x2F;name”])加载了后才有效。只能在define内部使用形如”.&#x2F;module&#x2F;name”的相对路径。</p>
<h3 id="四、CMD"><a href="#四、CMD" class="headerlink" title="四、CMD"></a>四、CMD</h3><p>CMD规范是阿里的玉伯提出来的，实现js库为sea.js。 它和requirejs非常类似，即一个js文件就是一个模块，但是CMD的加载方式更加优秀，是通过按需加载的方式，而不是必须在模块开始就加载所有的依赖。如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">&#x27;jquery&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Spinning</span> = <span class="built_in">require</span>(<span class="string">&#x27;./spinning&#x27;</span>);</span><br><span class="line">    <span class="built_in">exports</span>.<span class="property">doSomething</span> = ...</span><br><span class="line">    <span class="variable language_">module</span>.<span class="property">exports</span> = ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><em><strong>优点：</strong></em></p>
<p>同样实现了浏览器端的模块化加载。</p>
<p>可以按需加载，依赖就近。</p>
<p><em><strong>缺点：</strong></em></p>
<p>依赖SPM打包，模块的加载逻辑偏重。</p>
<p>其实，这时我们就可以看出AMD和CMD的区别了，前者是对于依赖的模块提前执行，而后者是延迟执行。 前者推崇依赖前置，而后者推崇依赖就近，即只在需要用到某个模块的时候再require。 如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AMD</span></span><br><span class="line"><span class="title function_">define</span>([<span class="string">&#x27;./a&#x27;</span>, <span class="string">&#x27;./b&#x27;</span>], <span class="keyword">function</span>(<span class="params">a, b</span>) &#123; <span class="comment">// 依赖必须一开始就写好</span></span><br><span class="line">    a.<span class="title function_">doSomething</span>()</span><br><span class="line"><span class="comment">// 此处略去 100 行</span></span><br><span class="line">    b.<span class="title function_">doSomething</span>()</span><br><span class="line">...</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// CMD</span></span><br><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">&#x27;./a&#x27;</span>)</span><br><span class="line">    a.<span class="title function_">doSomething</span>()</span><br><span class="line"><span class="comment">// 此处略去 100 行</span></span><br><span class="line">    <span class="keyword">var</span> b = <span class="built_in">require</span>(<span class="string">&#x27;./b&#x27;</span>)</span><br><span class="line"><span class="comment">// 依赖可以就近书写</span></span><br><span class="line">    b.<span class="title function_">doSomething</span>()</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p> 模块定义语法</p>
<p>define(id, deps, factory)</p>
<p>因为CMD推崇一个文件一个模块，所以经常就用文件名作为模块id；</p>
<p>CMD推崇依赖就近，所以一般不在define的参数中写依赖，而是在factory中写。</p>
<p>factory有三个参数：</p>
<p>function(require, exports, module){}</p>
<p>一、require</p>
<p>require 是 factory 函数的第一个参数，require 是一个方法，接受 模块标识 作为唯一参数，用来获取其他模块提供的接口；</p>
<p>二、exports</p>
<p>exports 是一个对象，用来向外提供模块接口；</p>
<p>三、module</p>
<p>module 是一个对象，上面存储了与当前模块相关联的一些属性和方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义模块 myModule.js</span></span><br><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) &#123;</span><br><span class="line">　　<span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">&#x27;jquery.js&#x27;</span>)</span><br><span class="line">　　$(<span class="string">&#x27;div&#x27;</span>).<span class="title function_">addClass</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载模块</span></span><br><span class="line">seajs.<span class="title function_">use</span>([<span class="string">&#x27;myModule.js&#x27;</span>], <span class="keyword">function</span>(<span class="params">my</span>)&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>4.1、Seajs</p>
<p>Seajs是一个加载器、遵循 CMD 规范模块化开发，依赖的自动加载、配置的简洁清晰。</p>
<p>SeaJS是一个遵循CMD规范的JavaScript模块加载框架，可以实现JavaScript的模块化开发及加载机制。</p>
<p>与jQuery等JavaScript框架不同，SeaJS不会扩展封装语言特性，而只是实现JavaScript的模块化及按模块加载。SeaJS的主要目的是令JavaScript开发模块化并可以轻松愉悦进行加载，将前端工程师从繁重的JavaScript文件及对象依赖处理中解放出来，可以专注于代码本身的逻辑。SeaJS可以与jQuery这类框架完美集成。使用SeaJS可以提高JavaScript代码的可读性和清晰度，解决目前JavaScript编程中普遍存在的依赖关系混乱和代码纠缠等问题，方便代码的编写和维护。</p>
<p>github:<a target="_blank" rel="noopener" href="https://github.com/seajs/seajs">https://github.com/seajs/seajs</a></p>
<p>官网：<a target="_blank" rel="noopener" href="http://www6.seajs.org/">http://www6.seajs.org</a></p>
<p><em><strong>特点：</strong></em></p>
<p>Sea.js 追求简单、自然的代码书写和组织方式，具有以下核心特性：</p>
<p>（一）、简单友好的模块定义规范：Sea.js 遵循 CMD 规范，可以像 Node.js 一般书写模块代码。</p>
<p>（二）、自然直观的代码组织方式：依赖的自动加载、配置的简洁清晰，可以让我们更多地享受编码的乐趣。</p>
<p>Sea.js 还提供常用插件，非常有助于开发调试和性能优化，并具有丰富的可扩展接口。</p>
<p>兼容：</p>
<blockquote>
<p>Chrome 3+ Firefox 2+ Safari 3.2+ Opera 10+ IE 5.5+</p>
</blockquote>
<p>基本应用：</p>
<p>导入Seajs库</p>
<p>去官网下载最新的seajs文件，<a target="_blank" rel="noopener" href="http://seajs.org/docs/#downloads">http://seajs.org/docs/#downloads</a></p>
<p>在页尾引入seajs：</p>
<script src="/site/script/sea.js"></script>

<p>然后在它下面写模块的配置和入口。</p>
<p>&#x2F;&#x2F; 加载入口模块seajs.use(“..&#x2F;static&#x2F;hello&#x2F;src&#x2F;main”);</p>
<p>配置和入口</p>
<p>这里解释下配置和入口的意思。</p>
<p>配置</p>
<p>通常在配置上修改seajs的路径和别名。</p>
<p>seajs的路径是相对于前面引入的seajs文件的。假如是这样的目录结构：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">examples/</span><br><span class="line">|-- index.<span class="property">html</span></span><br><span class="line">|</span><br><span class="line"><span class="string">`--about</span></span><br><span class="line"><span class="string">| |-- news.html</span></span><br><span class="line"><span class="string">|</span></span><br><span class="line"><span class="string">`</span>-- script</span><br><span class="line">|-- seajs.<span class="property">js</span></span><br><span class="line">|-- jquery.<span class="property">js</span></span><br><span class="line"><span class="string">`-- main.js</span></span><br></pre></td></tr></table></figure>

<p>我们平时如果我们在index.html上引用main.js路径应该是这样写的script&#x2F;main.js，从news.html引用main.js就要这样写，..&#x2F;script&#x2F;main.js。</p>
<p>而在seajs是相对于seajs文件的，一律直接使用main.js就OK了，是不是很方便呢？</p>
<p>既然这么方便那在什么情况需要配置呢？一般情况是用不到的。但是假如你的路径特别深 或者要做路径映射的时候它的作用就来了。下面介绍下常用的几个配置。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">seajs.<span class="title function_">config</span>(&#123;</span><br><span class="line"><span class="comment">// Sea.js 的基础路径（修改这个就不是路径就不是相对于seajs文件了）</span></span><br><span class="line">    <span class="attr">base</span>: <span class="string">&#x27;&lt;http://example.com/path/to/base/&gt;&#x27;</span>,</span><br><span class="line"><span class="comment">// 别名配置（用变量表示文件，解决路径层级过深和实现路径映射）</span></span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;es5-safe&#x27;</span>: <span class="string">&#x27;gallery/es5-safe/0.9.3/es5-safe&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;json&#x27;</span>: <span class="string">&#x27;gallery/json/1.0.2/json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;jquery&#x27;</span>: <span class="string">&#x27;jquery/jquery/1.10.1/jquery&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="comment">// 路径配置（用变量表示路径，解决路径层级过深的问题）</span></span><br><span class="line">    <span class="attr">paths</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;gallery&#x27;</span>: <span class="string">&#x27;&lt;https://a.alipayobjects.com/gallery&gt;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><em><strong>入口</strong></em></p>
<p>入口即加载，需要加载什么文件（模块加载器）就在这里引入。sea.js 在下载完成后，会自动加载入口模块。<br>seajs.use(“abc&#x2F;main”); &#x2F;&#x2F;导入seajs.js同级的abc文件夹下的main.js模块的（后缀名可略去不写）<br>seajs.use()还有另外一种用法。</p>
<p>有时候我们写一个简单的单页并不想为它单独写一个js文件，选择在直接把js代码写在页面上，seajs通过seajs.use()实现了这个。接收两个参数第一个是文件依赖(单个用字符串数组都可以，多个需用数组表示)，第二个是回调函数。</p>
<p><em><strong>加载单个依赖</strong></em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加载模块 main，并在加载完成时，执行指定回调</span></span><br><span class="line">seajs.<span class="title function_">use</span>(<span class="string">&#x27;./main&#x27;</span>, <span class="keyword">function</span>(<span class="params">main</span>) &#123;</span><br><span class="line">　　main.<span class="title function_">init</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><em><strong>加载多个依赖</strong></em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//并发加载模块 a 和模块 b，并在都加载完成时，执行指定回调</span></span><br><span class="line">seajs.<span class="title function_">use</span>([<span class="string">&#x27;./a&#x27;</span>, <span class="string">&#x27;./b&#x27;</span>], <span class="keyword">function</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    a.<span class="title function_">init</span>();</span><br><span class="line">    b.<span class="title function_">init</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这里回掉函数中的a和b参数是与前面的模块暴露出来的接口一一对应的。有时候也许只需要使用b的接口，但是也要把a参数写上。什么是暴露接口下面会解释。</p>
<p>通过seajs.use()只能在第一个参数中引入模块，不能在回调函数中使用require()载入模块。</p>
<p><em><strong>模块开发</strong></em></p>
<p>这里才是重点，其实也很简单就是一个书写规范（CMD）而已。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 所有模块都通过 define 来定义</span></span><br><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 require 引入依赖</span></span><br><span class="line"><span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">&#x27;jquery&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Spinning</span> = <span class="built_in">require</span>(<span class="string">&#x27;./spinning&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 exports 对外提供接口</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">doSomething</span> = ...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者通过 module.exports 提供整个接口</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = ...</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>模块是通过define()方法包装的，然后内部痛过require()方法引入需要的依赖文件(模块)。</p>
<p>模块最好是面向对象开发的，这样最后可以方便的通过exports.doSomething或module.exports把模块的接口给暴露出来。如果你是写的是jq插件的话就不需要这个功能了，因为你的接口是写在jquery的对象里的。如果你不需要提供接口的话也可以不使用这两个属性哦！</p>
<p>事实上define方法还有另外几个参数，一般情况我们用不到。具体看官方API。</p>
<p><strong>注意事项</strong></p>
<p>模块内的函数依赖必须交代清楚，防止模块在函数依赖加载前先加载出来。而且还增强了模块的独立性。<br>引入seajs的时候最好给script标签加个id，可以快速访问到这个标签（我是在模块合并时用到它的）<br>还有前面提到的使用seajs.use()在.html页面上写js时如果有多个模块依赖，需要使用暴露出来的接口就要让参数与它一一对应。</p>
<p>4.2、seajs示例</p>
<p>目录结构如下：<br><img src="/images/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/2-4.png"></p>
<p>moduleH.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span> (<span class="params"><span class="built_in">require</span>,<span class="built_in">exports</span>,<span class="variable language_">module</span></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> obj=&#123;</span><br><span class="line">        <span class="attr">msg</span>:<span class="string">&quot;Hello SeaJS!&quot;</span>,</span><br><span class="line">        <span class="attr">show</span>:<span class="function">()=&gt;</span><span class="variable language_">console</span>.<span class="title function_">info</span>(obj.<span class="property">msg</span>)</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">exports</span>.<span class="property">moduleH</span>=obj;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>main.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">seajs.<span class="title function_">config</span>(&#123;</span><br><span class="line">    <span class="comment">//Sea.js 的基础路径（修改这个就不是路径就不是相对于seajs文件了）</span></span><br><span class="line">    <span class="attr">base</span>: <span class="string">&#x27;./js/&#x27;</span>,</span><br><span class="line">    <span class="comment">//别名配置（用变量表示文件，解决路径层级过深和实现路径映射）</span></span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;jquery&#x27;</span>: <span class="string">&#x27;common/jquery/jquery-1.12.4&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//路径配置（用变量表示路径，解决路径层级过深的问题）</span></span><br><span class="line">    <span class="attr">paths</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;m&#x27;</span>: <span class="string">&#x27;module/&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">seajs.<span class="title function_">use</span>([<span class="string">&quot;m/moduleH.js&quot;</span>,<span class="string">&#x27;jquery&#x27;</span>], <span class="keyword">function</span> (<span class="params">mh,$</span>) &#123;</span><br><span class="line">    mh.<span class="property">moduleH</span>.<span class="title function_">show</span>();</span><br><span class="line">    $(<span class="string">&quot;body&quot;</span>).<span class="title function_">append</span>(<span class="string">&quot;&lt;h2&gt;Hello CMD!&lt;/h2&gt;&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>main.html</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/sea.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p>Hello CMD</p>
<p>4.3、官方文档</p>
<p>如果您要更加深入学习CMD与seajs可以参考下面的文档、<a target="_blank" rel="noopener" href="https://seajs.github.io/seajs/docs/">https://seajs.github.io/seajs/docs/</a></p>
<p>4.3.1、入门</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/547">前端模块化开发的价值</a></li>
<li><a target="_blank" rel="noopener" href="https://seajs.github.io/seajs/docs/#quick-start">5 分钟上手 Sea.js</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/examples">官方示例</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/266">API 快速参考</a></li>
</ul>
<p>4.3.2、基础</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/240">模块系统</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/242">CMD 模块定义规范</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/258">模块标识</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/259">require 书写约定</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/260">模块的加载启动</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/262">配置</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/538">构建工具</a></li>
</ul>
<p>4.3.3、插件</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs-css/blob/master/README.md">seajs-css</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs-preload/blob/master/README.md">seajs-preload</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs-text/blob/master/README.md">seajs-text</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs-style/blob/master/README.md">seajs-style</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs-combo/blob/master/README.md">seajs-combo</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs-flush/blob/master/README.md">seajs-flush</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs-debug/blob/master/README.md">seajs-debug</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs-log/blob/master/README.md">seajs-log</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs-health/blob/master/README.md">seajs-health</a></li>
</ul>
<p>4.3.4、进阶</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/263">Sea.js 的调试接口</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/426">为什么要有约定和构建工具</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/930">ID 和路径匹配原则</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/971">如何改造现有文件为 CMD 模块</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/276">如何参与开发</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/264">插件开发指南</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/spmjs/spm">包管理工具</a></li>
</ul>
<p>4.3.5、探讨</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/588">前端模块化开发那点历史</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/269">从 CommonJS 到 Sea.js</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/275">与 Node.js 兼容</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/seajs/seajs/issues/277">与 RequireJS 的异同</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dexteryy/OzJS/issues/10">与 OzJS 的探讨</a></li>
</ul>
<h3 id="五、原生模块化（ECMAScript模块化）"><a href="#五、原生模块化（ECMAScript模块化）" class="headerlink" title="五、原生模块化（ECMAScript模块化）"></a>五、原生模块化（ECMAScript模块化）</h3><p>ES6之前使用RequireJS或者seaJS实现模块化， requireJS是基于AMD规范的模块化库， 而像seaJS是基于CMD规范的模块化库， 两者都是为了为了推广前端模块化的工具。</p>
<p>现在ES6自带了模块化， 也是JS第一次支持module， 在很久以后 ，我们可以直接作用import和export在浏览器中导入和导出各个模块了， 一个js文件代表一个js模块；</p>
<p>现代浏览器对模块(module)支持程度不同， 目前都是使用babelJS， 或者Traceur把ES6代码转化为兼容ES5版本的js代码;</p>
<p>之前的几种模块化方案都是前端社区自己实现的，只是得到了大家的认可和广泛使用，而ES6的模块化方案是真正的规范。 在ES6中，我们可以使用 import 关键字引入模块，通过 export 关键字导出模块，功能较之于前几个方案更为强大，也是我们所推崇的，但是由于ES6目前无法在浏览器中执行，所以，我们只能通过babel将不被支持的import编译为当前受到广泛支持的 require。</p>
<p>虽然目前import和require的区别不大，但是还是推荐使用使用es6，因为未来es6必定是主流，对于代码的迁移成本还是非常容易的。 如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;../store/index&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;mapState, mapMutations, mapActions&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;../assets/js/request&#x27;</span></span><br><span class="line"><span class="keyword">import</span> util <span class="keyword">from</span> <span class="string">&#x27;../utils/js/util.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    created () &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getClassify</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">RESET_VALUE</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;created&#x27;</span> ,<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>5.1、ES6模块化特点</p>
<ol>
<li><p>每一个模块只加载一次， 每一个JS只执行一次， 如果下次再去加载同目录下同文件，直接从内存中读取。 一个模块就是一个单例，或者说就是一个对象；</p>
</li>
<li><p>每一个模块内声明的变量都是局部变量， 不会污染全局作用域；</p>
</li>
<li><p>模块内部的变量或者函数可以通过export导出；</p>
</li>
<li><p>一个模块可以导入别的模块</p>
</li>
</ol>
<p>5.2、在Chrome浏览器使用Module</p>
<p>Chrome 61就提供了对ES2015 import语句的支持，实现模块加载</p>
<p>查看版本的办法是：在chrome浏览器中输入chrome:&#x2F;&#x2F;version&#x2F;</p>
<p>谷歌浏览器(Canary 60) – 需要在chrome:flags里开启”实验性网络平台功能(Experimental Web Platform)”</p>
<p>示例：lib.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *定义模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//导出</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> msg=<span class="string">&quot;求和：&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">n</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> total=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        total+=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>html:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Module模块<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">//导入</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">import</span> &#123;sum,msg&#125; <span class="keyword">from</span> <span class="string">&#x27;./lib.js&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">let</span> result=<span class="title function_">sum</span>(<span class="number">100</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="variable language_">console</span>.<span class="title function_">log</span>(msg+<span class="string">&quot;&quot;</span>+result);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p>5.3、在Node.js中使用Module</p>
<p>5.3.1、方法一</p>
<p>在 Node.js 模块系统中，每个文件都被视为独立的模块。</p>
<p>例子，假设有一个名为 foo.js 的文件：</p>
<p>const circle &#x3D; require(‘.&#x2F;circle.js’); console.log(<code>半径为 4 的圆的面积是 $&#123;circle.area(4)&#125;</code>);</p>
<p>在第一行中，foo.js 加载了同一目录下的 circle.js 模块。</p>
<p>circle.js 文件的内容为：</p>
<p>const { PI } &#x3D; Math;</p>
<p>exports.area &#x3D; (r) &#x3D;&gt; PI * r ** 2;</p>
<p>exports.circumference &#x3D; (r) &#x3D;&gt; 2 <em>PI</em> r;</p>
<p>circle.js 模块导出了 area() 和 circumference() 两个函数。 通过在特殊的 exports 对象上指定额外的属性，函数和对象可以被添加到模块的根部。</p>
<p>模块内的本地变量是私有的，因为模块被 Node.js 包装在一个函数中（详见模块包装器）。 在这个例子中，变量 PI 是 circle.js 私有的。</p>
<p>module.exports属性可以被赋予一个新的值（例如函数或对象）。</p>
<p>如下，bar.js 会用到 square 模块，square 模块导出了 Square 类：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Square</span> = <span class="built_in">require</span>(<span class="string">&#x27;./square.js&#x27;</span>); <span class="keyword">const</span> mySquare = <span class="keyword">new</span> <span class="title class_">Square</span>(<span class="number">2</span>); <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`mySquare 的面积是 <span class="subst">$&#123;mySquare.area()&#125;</span>`</span>);</span><br><span class="line">square 模块定义在 square.<span class="property">js</span> 中：</span><br><span class="line"></span><br><span class="line"><span class="comment">// 赋值给 `exports` 不会修改模块，必须使用 `module.exports`</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">class</span> <span class="title class_">Square</span> &#123;</span><br><span class="line"><span class="title function_">constructor</span>(<span class="params">width</span>) &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">width</span> = width;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">area</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">width</span> ** <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>模块系统在 <code>require(&#39;module&#39;)</code> 模块中实现。</p>
<p>访问主模块</p>
<p>当 Node.js 直接运行一个文件时，require.main 会被设为它的 module。 这意味着可以通过 require.main &#x3D;&#x3D;&#x3D; module 来判断一个文件是否被直接运行：</p>
<p>对于 foo.js 文件，如果通过 node foo.js 运行则为 true，但如果通过 require(‘.&#x2F;foo’) 运行则为 false。</p>
<p>因为 module 提供了一个 filename 属性（通常等同于 __filename），所以可以通过检查 require.main.filename 来获取当前应用程序的入口点。</p>
<p>参考API：<a target="_blank" rel="noopener" href="http://nodejs.cn/api/modules.html">http://nodejs.cn/api/modules.html</a></p>
<p>5.3.2、方法二：experimental-modules</p>
<p>升级node 8.5 使用 experimental-modules参数，且要求所有文件名后缀都要修改为mjs</p>
<p>node –experimental-modules index.mjs</p>
<p>定义模块lib.mjs:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *定义模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//导出</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> msg=<span class="string">&quot;求和：&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">n</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> total=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        total+=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义main.mjs文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">- 使用模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//导入</span></span><br><span class="line"><span class="keyword">import</span> &#123; sum, msg &#125; <span class="keyword">from</span> <span class="string">&#x27;./lib.mjs&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> result = <span class="title function_">sum</span>(<span class="number">100</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(msg + <span class="string">&quot;&quot;</span> + result);</span><br></pre></td></tr></table></figure>

<p>在命令行下转换到当前目录，使用node加参数experimental-modules执行，结果如下：</p>
<p>5.4、Babel</p>
<p>Babel是一个广泛使用的转码器，可以将ES6代码转为ES5代码，从而在现有环境执行。</p>
<p>5.4.1、配置环境</p>
<p>安装babel命令行工具：</p>
<p>npm install –global babel-cli</p>
<p>安装成功后可以使用babel -V查看版本，可以使用babel -help 查看帮助</p>
<p>创建项目，在当前项目中依赖babel-core</p>
<p>假定当前项目的目录为：E:\Desktop-temp\xww\FastResponse\Mobile\Hybird\vue2_01\vue07_03_babel</p>
<p>使用npm init可以初始化当前项目为node项目</p>
<p>npm install babel-core –save</p>
<p>依赖插件babel-preset-es2015</p>
<p>如果想使用es6语法，必须安装一个插件</p>
<p>npm install babel-preset-es2015</p>
<p>然后在文件夹下面创建一个叫.babelrc的文件，并写入如下代码：</p>
<p>{ “presets”: [“es2015”] }</p>
<p>windows不支持直接命令为.babelrc，可以在DOS下使用@echo结合&gt;实现：</p>
<p>.babelrc文件以rc结尾的文件通常代表运行时自动加载的文件，配置等等的，类似bashrc,zshrc。同样babelrc在这里也是有同样的作用的，而且在babel6中，这个文件必不可少。</p>
<p>在babel6中，预设了6种，分别是：es2015、stage-0、stage-1、stage-2、stage-3、react</p>
<p>5.4.2、转换ES6为ES5</p>
<p>当环境准备好了，就可以编写一个es6风格的文件如：es6.js，内容如下：</p>
<p>let add&#x3D;(x,y)&#x3D;&gt;x+y; const n1&#x3D;100,n2&#x3D;200;var result&#x3D;add(n1,n2); console.log(result);<br>在当前目录执行命令：</p>
<p>babel es6.js -o es5.js</p>
<p>转换后的结果es5.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> add = <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> n1 = <span class="number">100</span>,</span><br><span class="line">    n2 = <span class="number">200</span>;</span><br><span class="line"><span class="keyword">var</span> result = <span class="title function_">add</span>(n1, n2);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br></pre></td></tr></table></figure>

<p>从转换后的结果可以看出es6已变成es5了，箭头函数不见了。</p>
<p>5.4.3、使用babel-node运行ES6模块化代码</p>
<p>babel-cli工具自带一个babel-node命令，提供一个支持ES6的REPL环境。它支持Node的REPL（交互式解释器环境）环境的所有功能，而且可以直接运行ES6代码。</p>
<p>在当前目录下创建lib.js文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *定义模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//导出</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> msg=<span class="string">&quot;求和：&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">n</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> total=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        total+=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建main.js文件调用定义好的模块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">- 使用模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//导入</span></span><br><span class="line"><span class="keyword">import</span> &#123; sum, msg &#125; <span class="keyword">from</span> <span class="string">&#x27;./lib.js&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> result = <span class="title function_">sum</span>(<span class="number">100</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(msg + <span class="string">&quot;&quot;</span> + result);</span><br></pre></td></tr></table></figure>

<p>在命令行执行：babel-node main.js 结果如下：</p>
<p>到这里共讲解了3种可以运行ES6模块化的环境，任选一种可以用于学习。</p>
<p>5.5、模块(Modules)</p>
<p>ES6从语言层面对模块进行了支持。编写方式借鉴了流行的JavaScript模块加载器（AMD, CommonJS）。由宿主环境的默认加载器定义模块运行时的行为，采取隐式异步模式——在模块可以被获取和加载前不会有代码执行。</p>
<p>定义模块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lib/math.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> pi = <span class="number">3.141593</span>;</span><br></pre></td></tr></table></figure>

<p>导入模块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//全部导入  </span></span><br><span class="line"><span class="keyword">import</span> people <span class="keyword">from</span> <span class="string">&#x27;./example&#x27;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//有一种特殊情况，即允许你将整个模块当作单一对象进行导入  </span></span><br><span class="line"><span class="comment">//该模块的所有导出都会作为对象的属性存在  </span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> example <span class="keyword">from</span> <span class="string">&quot;./example.js&quot;</span>  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(example.<span class="property">name</span>)  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(example.<span class="property">age</span>)  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(example.<span class="title function_">getName</span>())  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//导入部分  </span></span><br><span class="line"><span class="keyword">import</span> &#123;name, age&#125; <span class="keyword">from</span> <span class="string">&#x27;./example&#x27;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//导出默认, 有且只有一个默认  </span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// 部分导出  </span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">App</span> extend <span class="title class_">Component</span> &#123;&#125;;  </span><br></pre></td></tr></table></figure>

<p>*表示所有，as取别名</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">import</span>* <span class="keyword">as</span> math <span class="keyword">from</span> <span class="string">&quot;lib/math&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;2π = &quot;</span> + math.<span class="title function_">sum</span>(math.<span class="property">pi</span>, math.<span class="property">pi</span>));</span><br><span class="line"><span class="comment">// otherApp.js</span></span><br><span class="line">导入部分内容</span><br><span class="line"><span class="keyword">import</span> &#123;sum, pi&#125; <span class="keyword">from</span> <span class="string">&quot;lib/math&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;2π = &quot;</span> + <span class="title function_">sum</span>(pi, pi));</span><br><span class="line">还有的功能包括：<span class="keyword">export</span> <span class="keyword">default</span> and <span class="keyword">export</span> *:</span><br><span class="line"><span class="comment">// lib/mathplusplus.js</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;lib/math&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> e = <span class="number">2.71828182846</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params">x</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">exp</span>(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// app.js</span><br><span class="line">import exp, &#123;pi, e&#125; from &quot;lib/mathplusplus&quot;;</span><br><span class="line">console.log(&quot;e^π = &quot; + exp(pi));</span><br></pre></td></tr></table></figure>

<p>导入的时候有没有大括号的区别：</p>
<ul>
<li>1.当用export default people导出时，就用 import people 导入（不带大括号）</li>
<li>2.一个文件里，有且只能有一个export default。但可以有多个export。</li>
<li>3.当用export name 时，就用import { name }导入（记得带上大括号）</li>
<li>4.当一个文件里，既有一个export default people, 又有多个export name 或者 export age时，导入就用 import people, { name, age }</li>
<li>5.当一个文件里出现n多个 export 导出很多模块，导入时除了一个一个导入，也可以用import * as example</li>
<li></li>
</ul>
<p>模块的格式：</p>
<p>Babel可以将ES2015的模块转换为一下几种格式：Common.js，AMD，System，以及UMD。你甚至可以创建你自己的方式。</p>
<p>5.5.1、导出方式一</p>
<p>使用 export{接口} 导出接口， 大括号中的接口名字为上面定义的变量， import和export是对应的；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//lib.js 文件</span></span><br><span class="line"><span class="keyword">let</span> bar = <span class="string">&quot;stringBar&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> foo = <span class="string">&quot;stringFoo&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> fn0 = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fn0&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> fn1 = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fn1&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span>&#123; bar , foo, fn0, fn1&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//main.js文件</span></span><br><span class="line"><span class="keyword">import</span> &#123;bar,foo, fn0, fn1&#125; <span class="keyword">from</span> <span class="string">&quot;./lib&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bar+<span class="string">&quot;_&quot;</span>+foo);</span><br><span class="line"><span class="title function_">fn0</span>();</span><br><span class="line"><span class="title function_">fn1</span>();</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<p>先配置babel的运行环境，创建util.js文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable constant_">PI</span>=<span class="number">3.14</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getArea</span>(<span class="params">r</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable constant_">PI</span>*r*r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//集中导出对象</span></span><br><span class="line"><span class="keyword">export</span> &#123;<span class="variable constant_">PI</span>,getArea&#125;</span><br></pre></td></tr></table></figure>

<p>导入模块main.js：</p>
<p>import {PI,getArea} from ‘.&#x2F;util’  console.log(“R&#x3D;5时面积为：”+getArea(5));</p>
<p>结果：</p>
<p>5.5.2、导出方式二</p>
<p>在export接口的时候， 我们可以使用 XX as YY， 把导出的接口名字改了， 比如： closureFn as sayingFn， 把这些接口名字改成不看文档就知道干什么的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//lib.js文件</span></span><br><span class="line"><span class="keyword">let</span> fn0 = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fn0&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> obj0 = &#123;&#125;</span><br><span class="line"><span class="keyword">export</span> &#123; fn0 <span class="keyword">as</span> foo, obj0 <span class="keyword">as</span> bar&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//main.js文件</span></span><br><span class="line"><span class="keyword">import</span> &#123;foo, bar&#125; <span class="keyword">from</span> <span class="string">&quot;./lib&quot;</span>;</span><br><span class="line"><span class="title function_">foo</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bar);</span><br></pre></td></tr></table></figure>

<p>5.5.3、导出方式三</p>
<p>这种方式是直接在export的地方定义导出的函数，或者变量：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//lib.js文件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> <span class="title function_">foo</span> = (<span class="params"></span>)=&gt; &#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fnFoo&quot;</span>) ;<span class="keyword">return</span> <span class="string">&quot;foo&quot;</span>&#125;,bar = <span class="string">&quot;stringBar&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//main.js文件</span></span><br><span class="line"><span class="keyword">import</span> &#123;foo, bar&#125; <span class="keyword">from</span> <span class="string">&quot;./lib&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">foo</span>());</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bar);</span><br></pre></td></tr></table></figure>

<p>5.5.4、导出方式四</p>
<p>这种导出的方式不需要知道变量的名字， 相当于是匿名的， 直接把开发的接口给export；</p>
<p>如果一个js模块文件就只有一个功能， 那么就可以使用export default导出；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//lib.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">&quot;string&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//main.js</span></span><br><span class="line"><span class="keyword">import</span> defaultString <span class="keyword">from</span> <span class="string">&quot;./lib&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(defaultString);</span><br></pre></td></tr></table></figure>

<p>5.5.5、导出方式五</p>
<p>export也能默认导出函数， 在import的时候， 名字随便写， 因为每一个模块的默认接口就一个</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//lib.js</span></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">fn</span> = (<span class="params"></span>) =&gt; <span class="string">&quot;string&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;fn <span class="keyword">as</span> <span class="keyword">default</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//main.js</span></span><br><span class="line"><span class="keyword">import</span> defaultFn <span class="keyword">from</span> <span class="string">&quot;./lib&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">defaultFn</span>());</span><br></pre></td></tr></table></figure>

<p>5.5.6、导出方式六</p>
<p>使用通配符* ,重新导出其他模块的接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//lib.js</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./other&quot;</span>;</span><br><span class="line"><span class="comment">//如果只想导出部分接口， 只要把接口名字列出来</span></span><br><span class="line"><span class="comment">//export &#123;foo,fnFoo&#125; from &quot;./other&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//other.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> foo = <span class="string">&quot;stringFoo&quot;</span>, fnFoo = <span class="keyword">function</span>(<span class="params"></span>) &#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fnFoo&quot;</span>)&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;foo, fnFoo&#125; <span class="keyword">from</span> <span class="string">&quot;./lib&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">fnFoo</span>());</span><br></pre></td></tr></table></figure>

<p>在import的时候可以使用通配符*导入外部的模块：</p>
<p>import* as obj from “.&#x2F;lib”; console.log(obj);</p>
<p>5.6、模块加载器(Module Loaders)</p>
<p>这并不是ES2015的一部分：这部分ECMAScript 2015规范是由实现定义（implementation-defined）的。最终的标准将在WHATWG的Loader 规范中确定，目前这项工作正在进行中，下面的内容来自于之前的ES2015草稿。</p>
<p>模块加载器支持以下功能：</p>
<ul>
<li>动态加载（Dynamic loading）</li>
<li>状态一致性（State isolation）</li>
<li>全局空间一致性（Global namespace isolation）</li>
<li>编译钩子（Compilation hooks）</li>
<li>嵌套虚拟化（Nested virtualization）</li>
</ul>
<p>你可以对默认的加载器进行配置，构建出新的加载器，可以被加载于独立或受限的执行环境。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动态加载 – ‘System’ 是默认的加载器</span></span><br><span class="line"><span class="title class_">System</span>.<span class="keyword">import</span>(<span class="string">&quot;lib/math&quot;</span>).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">m</span>) &#123;</span><br><span class="line"><span class="title function_">alert</span>(<span class="string">&quot;2π = &quot;</span> + m.<span class="title function_">sum</span>(m.<span class="property">pi</span>, m.<span class="property">pi</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建执行沙箱 – new Loaders</span></span><br><span class="line"><span class="keyword">var</span> loader = <span class="keyword">new</span> <span class="title class_">Loader</span>(&#123;</span><br><span class="line"><span class="attr">global</span>: <span class="title function_">fixup</span>(<span class="variable language_">window</span>) <span class="comment">// replace ‘console.log’</span></span><br><span class="line">&#125;);</span><br><span class="line">loader.<span class="built_in">eval</span>(<span class="string">&quot;console.log(\&quot;hello world!\&quot;);&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接操作模块的缓存</span></span><br><span class="line"><span class="title class_">System</span>.<span class="title function_">get</span>(<span class="string">&quot;jquery&quot;</span>);</span><br><span class="line"><span class="title class_">System</span>.<span class="title function_">set</span>(<span class="string">&quot;jquery&quot;</span>, <span class="title class_">Module</span>(&#123;<span class="attr">$</span>: $&#125;)); <span class="comment">// WARNING: not yet finalized</span></span><br></pre></td></tr></table></figure>

<p>需要额外的polyfill</p>
<p>由于Babel默认使用common.js的模块，你需要一个polyfill来使用加载器API。</p>
<p>使用模块加载器</p>
<p>为了使用此功能，你需要告诉Babel使用system模块格式化工具。</p>
<h3 id="六、UMD（通用的模块定义）"><a href="#六、UMD（通用的模块定义）" class="headerlink" title="六、UMD（通用的模块定义）"></a>六、UMD（通用的模块定义）</h3><p>UMD（Universal Module Definition）通用的模块定义、UMD等于CommonJS加上AMD。UMD的工作其实就是做了一个判断：</p>
<ul>
<li>先判断当前环境对NodeJs支持的模块是否存在，存在就用Node.js模块模式（exports）。</li>
<li>如果不支持，就判断是否支持AMD（define），存在就使用AMD方式加载。</li>
</ul>
<p>CommonJs和AMD风格一样流行，似乎缺少一个统一的规范。所以人们产生了这样的需求，希望有支持两种风格的“通用”模式，于是通用模块规范（UMD）诞生了。</p>
<p>不得不承认，这个模式略难看，但是它兼容了AMD和CommonJS，同时还支持老式的“全局”变量规范，同时兼容前后端，模块定义写法如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params">root, factory</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">&#x27;function&#x27;</span> &amp;&amp; define.<span class="property">amd</span>) &#123;</span><br><span class="line"><span class="comment">// AMD. Register as an anonymous module.</span></span><br><span class="line">        <span class="title function_">define</span>([<span class="string">&#x27;b&#x27;</span>], factory);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">module</span> === <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="variable language_">module</span>.<span class="property">exports</span>) &#123;</span><br><span class="line"><span class="comment">// Node. Does not work with strict CommonJS, but</span></span><br><span class="line"><span class="comment">// only CommonJS-like environments that support module.exports,</span></span><br><span class="line"><span class="comment">// like Node.</span></span><br><span class="line">        <span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">factory</span>(<span class="built_in">require</span>(<span class="string">&#x27;b&#x27;</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// Browser globals (root is window)</span></span><br><span class="line">        root.<span class="property">returnExports</span> = <span class="title function_">factory</span>(root.<span class="property">b</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;(<span class="variable language_">this</span>, <span class="keyword">function</span> (<span class="params">b</span>) &#123;</span><br><span class="line"><span class="comment">//use b in some fashion.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Just return a value to define the module export.</span></span><br><span class="line"><span class="comment">// This example returns an object, but the module</span></span><br><span class="line"><span class="comment">// can return a function as the exported value.</span></span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<p>写法2：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params">root, factory</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">&#x27;function&#x27;</span> &amp;&amp; define.<span class="property">amd</span>) &#123;</span><br><span class="line"><span class="comment">// AMD</span></span><br><span class="line">        <span class="title function_">define</span>([<span class="string">&#x27;jquery&#x27;</span>, <span class="string">&#x27;underscore&#x27;</span>], factory);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">exports</span> === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// Node, CommonJS之类的</span></span><br><span class="line">        <span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">factory</span>(<span class="built_in">require</span>(<span class="string">&#x27;jquery&#x27;</span>), <span class="built_in">require</span>(<span class="string">&#x27;underscore&#x27;</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// 浏览器全局变量(root 即 window)</span></span><br><span class="line">        root.<span class="property">returnExports</span> = <span class="title function_">factory</span>(root.<span class="property">jQuery</span>, root.<span class="property">_</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;(<span class="variable language_">this</span>, <span class="keyword">function</span> (<span class="params">$,_</span>) &#123;</span><br><span class="line"><span class="comment">// 方法</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line">    &#125;; <span class="comment">// 私有方法，因为它没被返回 (见下面)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">b</span>(<span class="params"></span>) &#123;</span><br><span class="line">    &#125;; <span class="comment">// 公共方法，因为被返回了</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">c</span>(<span class="params"></span>) &#123;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="comment">//公共方法，因为被返回了</span></span><br><span class="line"><span class="comment">// 暴露公共方法</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">b</span>: b,</span><br><span class="line">        <span class="attr">c</span>: c</span><br><span class="line">    &#125;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<p>写法3(Vue)：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">- Vue.js v2.5.17</span></span><br><span class="line"><span class="comment">- (c) 2014-2018 Evan You</span></span><br><span class="line"><span class="comment">- Released under the MIT License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">(<span class="keyword">function</span> (<span class="params"><span class="variable language_">global</span>, factory</span>) &#123;</span><br><span class="line">    <span class="keyword">typeof</span> <span class="built_in">exports</span> === <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> <span class="variable language_">module</span> !== <span class="string">&#x27;undefined&#x27;</span> ? <span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">factory</span>() :</span><br><span class="line">    <span class="keyword">typeof</span> define === <span class="string">&#x27;function&#x27;</span> &amp;&amp; define.<span class="property">amd</span> ? <span class="title function_">define</span>(factory) :</span><br><span class="line">    (<span class="variable language_">global</span>.<span class="property">Vue</span> = <span class="title function_">factory</span>());</span><br><span class="line">&#125;(<span class="variable language_">this</span>, (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">return</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">&#125;)));</span><br></pre></td></tr></table></figure>

<p>6.1、UMD示例</p>
<p>6.1.1、定义模块Utils.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"><span class="variable language_">global</span>, factory</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">&#x27;function&#x27;</span> &amp;&amp; (define.<span class="property">amd</span> || define.<span class="property">cmd</span>)) &#123;</span><br><span class="line">        <span class="comment">// AMD规范. 注册一个匿名模块，兼容AMD与CMD</span></span><br><span class="line">        <span class="title function_">define</span>([], factory);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">module</span> === <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="variable language_">module</span>.<span class="property">exports</span>) &#123;</span><br><span class="line">        <span class="comment">//CommonJS规范，NodeJS运行环境</span></span><br><span class="line">        <span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">factory</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//浏览器全局对象注册</span></span><br><span class="line">        <span class="variable language_">global</span>.<span class="property">UMD</span> = <span class="title function_">factory</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;(<span class="variable language_">this</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> msg = <span class="string">&quot;UMD!&quot;</span>;</span><br><span class="line">    <span class="comment">//返回要导出的对象</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">show</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello &quot;</span> + msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<p>6.1.2、在CommonJS规范下运行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useUtils.<span class="property">js</span></span><br><span class="line"><span class="keyword">var</span> utils=<span class="built_in">require</span>(<span class="string">&#x27;./Utils.js&#x27;</span>); utils.<span class="title function_">show</span>();</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p>6.1.3、在AMD规范下运行<br>app.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置</span></span><br><span class="line">requirejs.<span class="title function_">config</span>(&#123;</span><br><span class="line">    <span class="comment">//模块依赖的基础路径，默认模块的加载位置</span></span><br><span class="line">    <span class="attr">baseUrl</span>:<span class="string">&#x27;js/&#x27;</span>,</span><br><span class="line">    <span class="comment">//路径</span></span><br><span class="line">    <span class="attr">paths</span>:&#123;</span><br><span class="line">        <span class="comment">//如果在路径前写上m/，则表示为：js/module/</span></span><br><span class="line">        <span class="attr">m</span>:<span class="string">&quot;module/&quot;</span>,</span><br><span class="line">        <span class="attr">jquery</span>:<span class="string">&#x27;common/jquery/jquery-1.12.4&#x27;</span>,</span><br><span class="line">        <span class="attr">md</span>:<span class="string">&#x27;module/moduleD&#x27;</span>,</span><br><span class="line">        <span class="attr">moduleE</span>:<span class="string">&#x27;module/moduleE&#x27;</span>,</span><br><span class="line">        <span class="attr">mf</span>:<span class="string">&#x27;module/moduleF&#x27;</span>,</span><br><span class="line">        <span class="attr">moduleG</span>:<span class="string">&#x27;module/moduleG&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//处理非标准的amd模块</span></span><br><span class="line">    <span class="attr">shim</span>:&#123;</span><br><span class="line">        <span class="comment">//这个键名为要载入的目标文件的文件名，不能随便命名否则拿不到改文件对外提供的接口的</span></span><br><span class="line">        <span class="string">&#x27;moduleE&#x27;</span>:&#123;</span><br><span class="line">            <span class="attr">exports</span>:<span class="string">&#x27;moduleE&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;moduleG&#x27;</span>:&#123;</span><br><span class="line">            <span class="attr">exports</span>:<span class="string">&#x27;moduleG&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//模块引用</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">&#x27;m/moduleB&#x27;</span>,<span class="string">&#x27;m/moduleC&#x27;</span>,<span class="string">&#x27;jquery&#x27;</span>,<span class="string">&#x27;md&#x27;</span>,<span class="string">&#x27;moduleE&#x27;</span>,<span class="string">&#x27;mf&#x27;</span>,<span class="string">&#x27;moduleG&#x27;</span>,<span class="string">&#x27;m/Tools&#x27;</span>,<span class="string">&#x27;m/Utils&#x27;</span>], <span class="keyword">function</span> (<span class="params">b,c,$,d,e,f,g,umd,mu</span>) &#123;</span><br><span class="line">    mu.<span class="title function_">show</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>index.html</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>AMD - requirejs<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/require2.1.11.js&quot;</span> <span class="attr">data-main</span>=<span class="string">&quot;js/app.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p>6.1.4、在CMD规范下运行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="property">js</span></span><br><span class="line">seajs.<span class="title function_">config</span>(&#123;</span><br><span class="line">    <span class="comment">// Sea.js 的基础路径（修改这个就不是路径就不是相对于seajs文件了）</span></span><br><span class="line">    <span class="attr">base</span>: <span class="string">&#x27;./javascript/module/&#x27;</span>,</span><br><span class="line">    <span class="comment">//别名配置（用变量表示文件，解决路径层级过深和实现路径映射）</span></span><br><span class="line">    <span class="attr">alias</span>:&#123;</span><br><span class="line">        <span class="string">&#x27;jquery&#x27;</span>:<span class="string">&#x27;common/jquery/jquery-1.12.4&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 路径配置（用变量表示路径，解决路径层级过深的问题）</span></span><br><span class="line">    <span class="attr">paths</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;xy&#x27;</span>: <span class="string">&#x27;xDirectory/yDirectory/&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//引用模块，依赖模块</span></span><br><span class="line"></span><br><span class="line">seajs.<span class="title function_">use</span>([<span class="string">&#x27;moduleA&#x27;</span>,<span class="string">&#x27;jquery&#x27;</span>,<span class="string">&#x27;xy/moduleC&#x27;</span>,<span class="string">&#x27;xy/moduleD&#x27;</span>,<span class="string">&#x27;Utils&#x27;</span>],<span class="keyword">function</span> (<span class="params">ma,$,mc,md,mu</span>) &#123;</span><br><span class="line">    mu.<span class="title function_">show</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>main.html</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/sea.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p>6.1.5、原生浏览器环境运行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>UMD<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;javascript/module/Utils.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    UMD.show();</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p>从上面的示例运行结果可以看出采用UMD定义的模块可以兼容CommonJS、AMD、CMD与浏览器原生环境，同时兼容前后台。写法并非固定可以根据需要变化。</p>
<h3 id="七、NodeJS包管理器"><a href="#七、NodeJS包管理器" class="headerlink" title="七、NodeJS包管理器"></a>七、NodeJS包管理器</h3><p>npm 为你和你的团队打开了连接整个 JavaScript 天才世界的一扇大门。它是世界上最大的软件注册表，每星期大约有 30 亿次的下载量，包含超过 600000 个 包（package） （即，代码模块）。来自各大洲的开源软件开发者使用 npm 互相分享和借鉴。包的结构使您能够轻松跟踪依赖项和版本。</p>
<p>仓库：<a target="_blank" rel="noopener" href="https://www.npmjs.com/">https://www.npmjs.com/</a></p>
<p>7.1、npm概要</p>
<p>npm全称为Node Package Manager，是一个基于Node.js的包管理器，也是整个Node.js社区最流行、支持的第三方模块最多的包管理器。</p>
<p>npm的初衷：JavaScript开发人员更容易分享和重用代码。</p>
<p>npm的使用场景：</p>
<ul>
<li>允许用户获取第三方包并使用。</li>
<li>允许用户将自己编写的包或命令行程序进行发布分享。</li>
<li></li>
</ul>
<p>npm版本查询：npm -v</p>
<p>npm安装：</p>
<p>　　1、安装nodejs</p>
<p>　　　　由于新版的nodejs已经集成了npm，所以可直接通过输入npm -v来测试是否成功安装。</p>
<p>　　2、使用npm命令来升级npm: npm install npm -g</p>
<p>7.2、包（package）</p>
<p>包是描述一个文件或一个目录。一个包的配置通常由以下构成：</p>
<ul>
<li>一个文件夹包含一个package.json配置文件。</li>
<li>包含（含有package.json文件的文件夹）的Gzip压缩文件。</li>
<li>解析gzip的url</li>
<li>为注册表添加<name>@<version>的url 信息</li>
</ul>
<p>注意的是即使你从来没有在注册中心发布你的公共包,你可能仍然可以得到很多所有这些package</p>
<p>7.3、模块（module）</p>
<p>模板是通过配置文件中的一个dom节点进行包含一个或多个包。通常一般由包和配置文件以及相关模块程序构成完成一个或多个业务功能操作。</p>
<p>一个模块可以在node . js 程序中装满任何的require()任何。 以下是所有事物加载模块的例子 :</p>
<p>一个文件夹package.json文件包含一个main字段。</p>
<p>一个文件夹index.js文件。</p>
<p>一个JavaScript文件。</p>
<p>7.4、包和模块的关系</p>
<p>一般来说在js程序中使用require加载它们的模块在节点中进行配置npm包，一个模块不一定是一个包。</p>
<p>例如,一些cli包, js程序节点中只包含一个可执行的 命令行界面,不提供main字段。 那么这些包不是模块。</p>
<p>几乎所有npm包(至少,那些节点计划)包含许多模块在他们(因为每个文件加载require()是一个模块)。</p>
<p>几乎所有的npm包都关联着多个模块，因为每个文件都使用require()加载一个模块。</p>
<p>从module加载文件中的上下文node节点。如：var req &#x3D; require(‘request’)。我们可能会说,“request模块赋值给req这个变量”。</p>
<p>7.5.npm的生态系统</p>
<p>package.json文件定义的是包。</p>
<p>node_modules文件夹是存储模块的地方。便于js查找模块。</p>
<p>例如： 如果创建一个node_modules&#x2F;foo.js文件，通过var f&#x3D;require(‘foo.js’)进行加载模块。因为它没有package.json文件所以foo.js不是一个包。 如果没有创建index.js包或者package.json文件”main”字段,即使是在安装node_modules,因为它没有require()所以它不是一个模块。</p>
<p>常用命令：</p>
<blockquote>
<p>npm install [-g] 本地或全局安装模块<br>npm uninstall [-g] 本地或全局卸载模块<br>npm update 更新模块<br>npm ls 查看安装的模块<br>npm list 列出已安装模块<br>npm show  显示模块详情<br>npm info 查看模块的详细信息<br>npm search 搜索模块<br>npm publish 发布模块<br>npm unpublish 删除已发布的模块<br>npm -v 或 npm version显示版本信息<br>npm view npm versions 列出npm 的所有有效版本<br>npm install -g <a href="mailto:&#x6e;&#112;&#109;&#x40;&#x32;&#46;&#x31;&#52;&#46;&#x31;&#x34;">&#x6e;&#112;&#109;&#x40;&#x32;&#46;&#x31;&#52;&#46;&#x31;&#x34;</a> &#x2F;npm update -g <a href="mailto:&#110;&#112;&#109;&#64;&#50;&#46;&#x31;&#x34;&#46;&#49;&#x34;">&#110;&#112;&#109;&#64;&#50;&#46;&#x31;&#x34;&#46;&#49;&#x34;</a>  安装指定的npm版本 npm init 引导创建一个package.json文件，包括名称、版本、作者这些信息等<br>npm outdated  #检查模块是否已经过时<br>npm root  [-g] 查看包的安装路径，输出 node_modules的路径，<br>npm help 查看某条命令的详细帮助 例如输入npm help install npm config 管理npm的配置路径</p>
</blockquote>
<p>更多介绍：</p>
<p>npm中文网：<a target="_blank" rel="noopener" href="https://www.npmjs.com.cn/">https://www.npmjs.com.cn/</a></p>
<p>点击查看《Node.js开发Web后台服务》</p>
<h3 id="八、视频"><a href="#八、视频" class="headerlink" title="八、视频"></a>八、视频</h3><p> <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av37008594/">https://www.bilibili.com/video/av37008594/</a></p>
<h3 id="九、示例"><a href="#九、示例" class="headerlink" title="九、示例"></a>九、示例</h3><p><a target="_blank" rel="noopener" href="https://git.dev.tencent.com/zhangguo5/ModuleDemo.git">https://git.dev.tencent.com/zhangguo5/ModuleDemo.git</a></p>
<p><a target="_blank" rel="noopener" href="https://git.dev.tencent.com/zhangguo5/Module01.git">https://git.dev.tencent.com/zhangguo5/Module01.git</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Eric</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/01/11/30%E5%88%86%E9%92%9F%E5%AD%A6%E4%BC%9A%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%80%E5%8F%91(%E5%AD%A6%E4%B9%A0)/">http://example.com/2023/01/11/30%E5%88%86%E9%92%9F%E5%AD%A6%E4%BC%9A%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%80%E5%8F%91(%E5%AD%A6%E4%B9%A0)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Eric的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Eric%E7%9A%84%E5%8D%9A%E5%AE%A2/">Eric的博客</a></div><div class="post_share"><div class="social-share" data-image="https://pic.20988.xyz/2024-05-29/1716947455-652516-001-2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/01/12/%E4%BD%BF%E7%94%A8vscode%E5%BC%80%E5%8F%91%E5%AE%9E%E6%97%B6%E9%A2%84%E8%A7%88markdown/" title="使用vscode开发时实现实时预览"><img class="cover" src="https://pic.20988.xyz/2024-05-29/1716947303-2181-9.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">使用vscode开发时实现实时预览</div></div></a></div><div class="next-post pull-right"><a href="/2022/11/10/markdown%E8%AF%AD%E6%B3%95%E6%96%87%E4%BB%B6/" title="Markdown使用说明"><img class="cover" src="/img/14.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Markdown使用说明</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/06/30/JS%E5%8E%9F%E7%94%9F-JS%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E6%9C%BA%E5%88%B6/" title="JS原生-JS事件循环机制"><img class="cover" src="/img/13.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-30</div><div class="title">JS原生-JS事件循环机制</div></div></a></div><div><a href="/2023/10/07/Js%E5%AE%9E%E7%8E%B0%E6%89%81%E5%B9%B3%E5%8C%96%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8Ctree%E8%BD%AC%E6%8D%A2/" title="Js实现扁平化数据结构和tree转换"><img class="cover" src="/img/22.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-07</div><div class="title">Js实现扁平化数据结构和tree转换</div></div></a></div><div><a href="/2023/06/30/JS%E5%8E%9F%E7%94%9F-%E5%8E%9F%E5%9E%8B-%E5%8E%9F%E5%9E%8B%E9%93%BE/" title="JS原生-原型-原型链"><img class="cover" src="https://pic.20988.xyz/2024-05-29/1716947219-264223-4.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-30</div><div class="title">JS原生-原型-原型链</div></div></a></div><div><a href="/2023/10/07/echarts%E9%AB%98%E7%BA%A7%E6%95%88%E6%9E%9C%E7%9B%B8%E5%85%B3%E7%BD%91%E7%AB%99%E7%A4%BE%E5%8C%BA/" title="Echarts高级可视化应用"><img class="cover" src="/img/1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-07</div><div class="title">Echarts高级可视化应用</div></div></a></div><div><a href="/2024/07/02/Vue3.0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/" title="Vue3.0学习笔记（持续更新）"><img class="cover" src="/img/5.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-02</div><div class="title">Vue3.0学习笔记（持续更新）</div></div></a></div><div><a href="/2023/08/20/git%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/" title="Git使用总结"><img class="cover" src="/img/2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-20</div><div class="title">Git使用总结</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/Avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Eric</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Alone-Michael/"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96%E6%A6%82%E8%A6%81"><span class="toc-number">2.</span> <span class="toc-text">一、前端模块化概要</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81CommonJS"><span class="toc-number">3.</span> <span class="toc-text">二、CommonJS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81AMD"><span class="toc-number">4.</span> <span class="toc-text">三、AMD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81CMD"><span class="toc-number">5.</span> <span class="toc-text">四、CMD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%8E%9F%E7%94%9F%E6%A8%A1%E5%9D%97%E5%8C%96%EF%BC%88ECMAScript%E6%A8%A1%E5%9D%97%E5%8C%96%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">五、原生模块化（ECMAScript模块化）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81UMD%EF%BC%88%E9%80%9A%E7%94%A8%E7%9A%84%E6%A8%A1%E5%9D%97%E5%AE%9A%E4%B9%89%EF%BC%89"><span class="toc-number">7.</span> <span class="toc-text">六、UMD（通用的模块定义）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E3%80%81NodeJS%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">8.</span> <span class="toc-text">七、NodeJS包管理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E8%A7%86%E9%A2%91"><span class="toc-number">9.</span> <span class="toc-text">八、视频</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">10.</span> <span class="toc-text">九、示例</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/07/02/Vue3.0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/" title="Vue3.0学习笔记（持续更新）"><img src="/img/5.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue3.0学习笔记（持续更新）"/></a><div class="content"><a class="title" href="/2024/07/02/Vue3.0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/" title="Vue3.0学习笔记（持续更新）">Vue3.0学习笔记（持续更新）</a><time datetime="2024-07-01T16:00:00.000Z" title="发表于 2024-07-02 00:00:00">2024-07-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/25/%E9%9D%A2%E8%AF%95/" title="面试"><img src="[&quot;https://pic.20988.xyz/2024-06-19/1718801338-318513-20240619145759.jpg&quot;,&quot;https://pic.20988.xyz/2024-05-29/1716947214-777607-2.jpg&quot;,&quot;https://pic.20988.xyz/2024-05-29/1716947219-264223-4.jpg&quot;,&quot;https://pic.20988.xyz/2024-05-29/1716947303-2181-9.jpg&quot;,&quot;https://pic.20988.xyz/2024-05-29/1716947455-652516-001-2.jpg&quot;,&quot;https://pic.20988.xyz/2024-06-03/1717377438-28416-4k.jpg&quot;,&quot;https://pic.20988.xyz/2024-06-07/1717747427-499325-bg-i3.png&quot;,&quot;https://pic.20988.xyz/2024-06-08/1717833675-823265-gondam.jpg&quot;,&quot;https://pic.20988.xyz/2024-06-08/1717833666-732541-05.png&quot;,&quot;https://pic.20988.xyz/2024-06-08/1717833691-793087-miku02.jpg&quot;]" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="面试"/></a><div class="content"><a class="title" href="/2024/06/25/%E9%9D%A2%E8%AF%95/" title="面试">面试</a><time datetime="2024-06-24T16:00:00.000Z" title="发表于 2024-06-25 00:00:00">2024-06-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/21/%E9%A1%B9%E7%9B%AE%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0/" title="常用的工具函数"><img src="/img/19.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="常用的工具函数"/></a><div class="content"><a class="title" href="/2024/06/21/%E9%A1%B9%E7%9B%AE%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0/" title="常用的工具函数">常用的工具函数</a><time datetime="2024-06-20T16:00:00.000Z" title="发表于 2024-06-21 00:00:00">2024-06-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/20/%E9%A1%B9%E7%9B%AE%E5%B8%B8%E7%94%A8%E7%9A%84%E6%AD%A3%E5%88%99%E6%A0%A1%E9%AA%8C%E6%96%B9%E6%B3%95/" title="项目常用的正则校验方法"><img src="/img/4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="项目常用的正则校验方法"/></a><div class="content"><a class="title" href="/2024/06/20/%E9%A1%B9%E7%9B%AE%E5%B8%B8%E7%94%A8%E7%9A%84%E6%AD%A3%E5%88%99%E6%A0%A1%E9%AA%8C%E6%96%B9%E6%B3%95/" title="项目常用的正则校验方法">项目常用的正则校验方法</a><time datetime="2024-06-19T16:00:00.000Z" title="发表于 2024-06-20 00:00:00">2024-06-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/19/vue3%E6%A0%B8%E5%BF%83%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/" title="vue3核心问题总结"><img src="/img/23.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="vue3核心问题总结"/></a><div class="content"><a class="title" href="/2024/06/19/vue3%E6%A0%B8%E5%BF%83%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/" title="vue3核心问题总结">vue3核心问题总结</a><time datetime="2024-06-18T16:00:00.000Z" title="发表于 2024-06-19 00:00:00">2024-06-19</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Eric</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>